diff --git a/analysis/default_inv.jsonl b/analysis/default_inv.jsonl
index 93fd1aa..c91d2c2 100644
--- a/analysis/default_inv.jsonl
+++ b/analysis/default_inv.jsonl
@@ -1 +1 @@
-{"RUN.prefix": "diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100", "seed": 100, "returns_condition": true, "predict_epsilon": true, "n_diffusion_steps": 200, "condition_dropout": 0.25, "diffusion": "models.GaussianInvDynDiffusion", "n_train_steps": 1000000.0, "dataset": "hopper-medium-expert-v2", "returns_scale": 400.0, "RUN.job_counter": 1, "RUN.job_name": "predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100"}
+{"RUN.prefix": "diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100", "seed": 100, "returns_condition": true, "predict_epsilon": true, "n_diffusion_steps": 200, "condition_dropout": 0.25, "diffusion": "models.GaussianInvDynDiffusion", "n_train_steps": 1000000.0, "dataset": "hopper-medium-expert-v2", "returns_scale": 400.0, "RUN.job_counter": 1, "RUN.job_name": "predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100"}
diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
index 5ff999f..166c490 100644
--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
@@ -11634,4 +11634,3503 @@ index db05e5a..53b8e2f 100644
 +            transition_dim=observation_dim,
              cond_dim=observation_dim,
              dim_mults=Config.dim_mults,
-             returns_condition=Config.returns_condition,
\ No newline at end of file
+             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+index 0136a00..53904ea 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+ │        loss        │       0.020        │
+ ╘════════════════════╧════════════════════╛
+ 
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-05 16:58:52.964119
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
+GIT binary patch
+delta 84
+zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
+oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
+
+delta 13
+UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
+
+diff --git a/analysis/outputs.log b/analysis/outputs.log
+index b36abbc..d41a0b9 100644
+--- a/analysis/outputs.log
++++ b/analysis/outputs.log
+@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+index 0b6e0bf..a4200ea 100644
+--- a/diffuser/utils/training.py
++++ b/diffuser/utils/training.py
+@@ -113,7 +113,7 @@ class Trainer(object):
+             for i in range(self.gradient_accumulate_every):
+                 batch = next(self.dataloader)
+                 batch = batch_to_device(batch, device=self.device)
+-                # breakpoint()
++                breakpoint()
+                 loss, infos = self.model.loss(*batch)
+                 loss = loss / self.gradient_accumulate_every
+                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+index 5ff999f..38f3578 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+@@ -11634,4 +11634,86 @@ index db05e5a..53b8e2f 100644
+ +            transition_dim=observation_dim,
+              cond_dim=observation_dim,
+              dim_mults=Config.dim_mults,
+-             returns_condition=Config.returns_condition,
+\ No newline at end of file
++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..53904ea 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
++GIT binary patch
++delta 84
++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
++
++delta 13
++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
++
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..d41a0b9 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()
+\ No newline at end of file
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
+index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..6f13a7941ab36998ac949d345b5116109a90f9c7 100644
+GIT binary patch
+delta 13
+UcmZ21zCwJ%Vs6$3mf9(L03wzIpa1{>
+
+delta 7
+OcmZ1>zF2(2Vr~Eo6$01*
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+index 0136a00..6943886 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+@@ -10016,3 +10016,191 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+ │        loss        │       0.020        │
+ ╘════════════════════╧════════════════════╛
+ 
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-05 16:58:52.964119
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-05 16:58:52.993286
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 00:58:50.921304+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Testing forward... ✓
++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-05 17:05:07.186644
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-06 02:50:33.911493
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0155f5d4aa158f490a1eb2ecebfe3c179f54a7f1 100644
+GIT binary patch
+delta 217
+zcmYMuu}T9$5P)HJ!7327)GAt~I%Z~PXLh#I#`oCU%YjycFJNJpGJ=m_p9@@JEdj9+
+zeF2{&Q5*Z8kAJ(I?4Bq04{qbPujB2Dzjjl}G37{&2_xF-`|)Hhm@2dOT_H$VD)*&;
+zkQuRR*An*CL_-}v*8bf83l=EJaQS|5a3nK;KNuP#3^1Nux#A8{GsFzqU=m>-+~<w^
+uZ7D~{AvA`__Jnu-bY5G4ilHl_G4+ORBE*h#A<9}4|NJh1QHJBUFSiG@F*_~*
+
+delta 13
+Ucmeyrocnk;cS8%~7N+Az0WK5<RsaA1
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+index 9a48946..0b164e7 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+@@ -1019,3 +1019,17 @@ Traceback (most recent call last):
+   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
+     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
+ AttributeError: 'tuple' object has no attribute 'float'
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
+diff --git a/analysis/outputs.log b/analysis/outputs.log
+index b36abbc..8658a70 100644
+--- a/analysis/outputs.log
++++ b/analysis/outputs.log
+@@ -65,3 +65,5 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diff --git a/config/locomotion_config.py b/config/locomotion_config.py
+index 7c6d244..314d783 100644
+--- a/config/locomotion_config.py
++++ b/config/locomotion_config.py
+@@ -6,7 +6,7 @@ class Config(ParamsProto):
+     # misc
+     seed = 100
+     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
+-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
+ 
+     ## model
+diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
+index 43dfdbf..adc2a19 100644
+--- a/diffuser/models/diffusion.py
++++ b/diffuser/models/diffusion.py
+@@ -3,6 +3,7 @@ import torch
+ from torch import nn
+ import torch.nn.functional as F
+ import pdb
++import clip
+ from config.locomotion_config import Config
+ 
+ import diffuser.utils as utils
+@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
+         self.model = model
+         self.ar_inv = ar_inv
+         self.train_only_inv = train_only_inv
++        self.device = Config.device
+ 
+         # Text embedding
+-        device = Config.device
+-        self.proj_layer = nn.Linear(512, self.observation_dim)
++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
++        self.text_encoder.float()
+ 
+         if self.ar_inv:
+             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
+diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+index 0b6e0bf..a4200ea 100644
+--- a/diffuser/utils/training.py
++++ b/diffuser/utils/training.py
+@@ -113,7 +113,7 @@ class Trainer(object):
+             for i in range(self.gradient_accumulate_every):
+                 batch = next(self.dataloader)
+                 batch = batch_to_device(batch, device=self.device)
+-                # breakpoint()
++                breakpoint()
+                 loss, infos = self.model.loss(*batch)
+                 loss = loss / self.gradient_accumulate_every
+                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+index 5ff999f..40ff74e 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+@@ -11634,4 +11634,480 @@ index db05e5a..53b8e2f 100644
+ +            transition_dim=observation_dim,
+              cond_dim=observation_dim,
+              dim_mults=Config.dim_mults,
+-             returns_condition=Config.returns_condition,
+\ No newline at end of file
++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..53904ea 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
++GIT binary patch
++delta 84
++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
++
++delta 13
++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
++
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..d41a0b9 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++index 5ff999f..38f3578 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++@@ -11634,4 +11634,86 @@ index db05e5a..53b8e2f 100644
++ +            transition_dim=observation_dim,
++              cond_dim=observation_dim,
++              dim_mults=Config.dim_mults,
++-             returns_condition=Config.returns_condition,
++\ No newline at end of file
+++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++index 0136a00..53904ea 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+++ │        loss        │       0.020        │
+++ ╘════════════════════╧════════════════════╛
+++ 
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++    script_path     │ None                
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      counter       │ 2                   
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++       status       │ created             
++++     createTime     │ 2023-12-05 16:58:52.964119
++++════════════════════╧═════════════════════
++++[33m      revision      [0m
++++────────────────────┬─────────────────────
++++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++++       branch       │ refs/heads/main     
++++════════════════════╧═════════════════════
++++[33m         fn         [0m
++++────────────────────┬─────────────────────
++++        name        │ main                
++++        doc         │ None                
++++       module       │ scripts.train       
++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++++════════════════════╧═════════════════════
++++[33m        args        [0m
++++────────────────────┬─────────────────────
++++()
++++════════════════════╧═════════════════════
++++[33m       kwargs       [0m
++++────────────────────┬─────────────────────
++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        seed        │ 100                 
++++ returns_condition  │ True                
++++  predict_epsilon   │ True                
++++ n_diffusion_steps  │ 200                 
++++ condition_dropout  │ 0.25                
++++     diffusion      │ models.GaussianInvDynDiffusion
++++   n_train_steps    │ 1000000.0           
++++      dataset       │ hopper-medium-expert-v2
++++   returns_scale    │ 400.0               
++++  RUN.job_counter   │ 1                   
++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++════════════════════╧═════════════════════
++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
+++GIT binary patch
+++delta 84
+++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
+++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
+++
+++delta 13
+++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
+++
+++diff --git a/analysis/outputs.log b/analysis/outputs.log
+++index b36abbc..d41a0b9 100644
+++--- a/analysis/outputs.log
++++++ b/analysis/outputs.log
+++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+++index 0b6e0bf..a4200ea 100644
+++--- a/diffuser/utils/training.py
++++++ b/diffuser/utils/training.py
+++@@ -113,7 +113,7 @@ class Trainer(object):
+++             for i in range(self.gradient_accumulate_every):
+++                 batch = next(self.dataloader)
+++                 batch = batch_to_device(batch, device=self.device)
+++-                # breakpoint()
++++                breakpoint()
+++                 loss, infos = self.model.loss(*batch)
+++                 loss = loss / self.gradient_accumulate_every
+++                 loss.backward()
++\ No newline at end of file
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
++index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..6f13a7941ab36998ac949d345b5116109a90f9c7 100644
++GIT binary patch
++delta 13
++UcmZ21zCwJ%Vs6$3mf9(L03wzIpa1{>
++
++delta 7
++OcmZ1>zF2(2Vr~Eo6$01*
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..6943886 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,191 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       job_id       │ None                
+++       status       │ started             
+++     startTime      │ 2023-12-05 16:58:52.993286
+++════════════════════╧═════════════════════
+++[33m        host        [0m
+++────────────────────┬─────────────────────
+++      hostname      │ vll-weiyuan         
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m       Config       [0m
+++────────────────────┬─────────────────────
+++        seed        │ 100                 
+++       device       │ cuda                
+++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+++      dataset       │ hopper-medium-expert-v2
+++       model        │ models.TemporalUnet 
+++     diffusion      │ models.GaussianInvDynDiffusion
+++      horizon       │ 100                 
+++ n_diffusion_steps  │ 200                 
+++   action_weight    │ 10                  
+++    loss_weights    │ None                
+++   loss_discount    │ 1                   
+++  predict_epsilon   │ True                
+++     dim_mults      │ (1, 4, 8)           
+++ returns_condition  │ True                
+++    calc_energy     │ False               
+++        dim         │ 128                 
+++ condition_dropout  │ 0.25                
+++condition_guidance_w│ 1.2                 
+++      test_ret      │ 0.9                 
+++      renderer      │ utils.MuJoCoRenderer
+++       loader       │ datasets.SequenceDataset
+++     normalizer     │ CDFNormalizer       
+++   preprocess_fns   │ []                  
+++   clip_denoised    │ True                
+++    use_padding     │ True                
+++  include_returns   │ True                
+++      discount      │ 0.99                
+++  max_path_length   │ 1000                
+++     hidden_dim     │ 256                 
+++       ar_inv       │ False               
+++   train_only_inv   │ False               
+++termination_penalty │ -100                
+++   returns_scale    │ 400.0               
+++ n_steps_per_epoch  │ 10000               
+++     loss_type      │ l2                  
+++   n_train_steps    │ 1000000.0           
+++     batch_size     │ 32                  
+++   learning_rate    │ 0.0002              
+++gradient_accumulate_every│ 2                   
+++     ema_decay      │ 0.995               
+++      log_freq      │ 1000                
+++     save_freq      │ 10000               
+++    sample_freq     │ 10000               
+++      n_saves       │ 5                   
+++   save_parallel    │ False               
+++    n_reference     │ 8                   
+++  save_checkpoints  │ False               
+++════════════════════╧═════════════════════
+++[33m        RUN         [0m
+++────────────────────┬─────────────────────
+++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      username      │ yanyangji           
+++      project       │ diffuser            
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++    script_path     │ None                
+++        now         │ 2023-12-06 00:58:50.921304+08:00
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++    job_counter     │ 1                   
+++       resume       │ True                
+++       readme       │ None                
+++       debug        │ False               
+++CUDA_VISIBLE_DEVICES│ None                
+++     file_stem      │ train               
+++════════════════════╧═════════════════════
+++Testing forward... ✓
+++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
+++
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       status       │ errored             
+++     errorTime      │ 2023-12-05 17:05:07.186644
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-06 02:50:33.911493
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0155f5d4aa158f490a1eb2ecebfe3c179f54a7f1 100644
++GIT binary patch
++delta 217
++zcmYMuu}T9$5P)HJ!7327)GAt~I%Z~PXLh#I#`oCU%YjycFJNJpGJ=m_p9@@JEdj9+
++zeF2{&Q5*Z8kAJ(I?4Bq04{qbPujB2Dzjjl}G37{&2_xF-`|)Hhm@2dOT_H$VD)*&;
++zkQuRR*An*CL_-}v*8bf83l=EJaQS|5a3nK;KNuP#3^1Nux#A8{GsFzqU=m>-+~<w^
++uZ7D~{AvA`__Jnu-bY5G4ilHl_G4+ORBE*h#A<9}4|NJh1QHJBUFSiG@F*_~*
++
++delta 13
++Ucmeyrocnk;cS8%~7N+Az0WK5<RsaA1
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++index 9a48946..0b164e7 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++@@ -1019,3 +1019,17 @@ Traceback (most recent call last):
++   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
++     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
++ AttributeError: 'tuple' object has no attribute 'float'
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..8658a70 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,5 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/config/locomotion_config.py b/config/locomotion_config.py
++index 7c6d244..314d783 100644
++--- a/config/locomotion_config.py
+++++ b/config/locomotion_config.py
++@@ -6,7 +6,7 @@ class Config(ParamsProto):
++     # misc
++     seed = 100
++     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
++-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
++ 
++     ## model
++diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
++index 43dfdbf..adc2a19 100644
++--- a/diffuser/models/diffusion.py
+++++ b/diffuser/models/diffusion.py
++@@ -3,6 +3,7 @@ import torch
++ from torch import nn
++ import torch.nn.functional as F
++ import pdb
+++import clip
++ from config.locomotion_config import Config
++ 
++ import diffuser.utils as utils
++@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
++         self.model = model
++         self.ar_inv = ar_inv
++         self.train_only_inv = train_only_inv
+++        self.device = Config.device
++ 
++         # Text embedding
++-        device = Config.device
++-        self.proj_layer = nn.Linear(512, self.observation_dim)
+++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
+++        self.text_encoder.float()
++ 
++         if self.ar_inv:
++             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()
+\ No newline at end of file
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
+index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..c1d221b35a1e6e7cab20fdd218448b73984a7b8f 100644
+GIT binary patch
+delta 18
+WcmZ21zE*t0Vs5Smmf9(LU;+R?ng(qE
+
+delta 7
+OcmZ20zF2(2Vr~EoI0D@O
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+index 0136a00..93fce68 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+@@ -10016,3 +10016,334 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+ │        loss        │       0.020        │
+ ╘════════════════════╧════════════════════╛
+ 
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-05 16:58:52.964119
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-05 16:58:52.993286
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 00:58:50.921304+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Testing forward... ✓
++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-05 17:05:07.186644
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-06 02:50:33.911493
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-06 02:50:33.953978
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 10:50:31.778840+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-06 02:50:35.849523
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-06 02:54:15.281510
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0a8eca6f0943babca69daf94ba5186278e81a2fa 100644
+GIT binary patch
+delta 357
+zcmb7=u}T9$6h)bVQ~@=OppDTgAPn!#ym@bCDs9r|2ZY_(ENCV80~UgXWrTc$ohxi1
+zmJ$#f(I4;&`~}w~AeOe5%ejZUx*6U*4KJ_MgI+zi=a2eSZE*4-d21pQVqARQ?o1d%
+zCX%`;ECehv)kOhpW3(hvl@{w9SzK=4?)8EGB}8WfH^;9>gDoBd^k6X2qJwsSstUD<
+zlE5brgMpc-QSWE!r)!gk<eZ6!6qk6RcPF_7$mptq#fLg#87yLDWzIs919iT0AmnEB
+zvZwzryo<7!Ef1S7*&d8|jGakGM<WsfK{LBPQC++q^`>Ka>w1@UObNZQ0X;&0$Uj^@
+F)Hlu|UN8Uv
+
+delta 13
+UcmZ3zm-~1(cS8%~7N+Az0V>!A7ytkO
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+index 9a48946..4a0b118 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+@@ -1019,3 +1019,31 @@ Traceback (most recent call last):
+   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
+     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
+ AttributeError: 'tuple' object has no attribute 'float'
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+diff --git a/analysis/outputs.log b/analysis/outputs.log
+index b36abbc..6c7de88 100644
+--- a/analysis/outputs.log
++++ b/analysis/outputs.log
+@@ -65,3 +65,6 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diff --git a/config/locomotion_config.py b/config/locomotion_config.py
+index 7c6d244..314d783 100644
+--- a/config/locomotion_config.py
++++ b/config/locomotion_config.py
+@@ -6,7 +6,7 @@ class Config(ParamsProto):
+     # misc
+     seed = 100
+     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
+-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
+ 
+     ## model
+diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
+index 43dfdbf..adc2a19 100644
+--- a/diffuser/models/diffusion.py
++++ b/diffuser/models/diffusion.py
+@@ -3,6 +3,7 @@ import torch
+ from torch import nn
+ import torch.nn.functional as F
+ import pdb
++import clip
+ from config.locomotion_config import Config
+ 
+ import diffuser.utils as utils
+@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
+         self.model = model
+         self.ar_inv = ar_inv
+         self.train_only_inv = train_only_inv
++        self.device = Config.device
+ 
+         # Text embedding
+-        device = Config.device
+-        self.proj_layer = nn.Linear(512, self.observation_dim)
++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
++        self.text_encoder.float()
+ 
+         if self.ar_inv:
+             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
+diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+index 0b6e0bf..a4200ea 100644
+--- a/diffuser/utils/training.py
++++ b/diffuser/utils/training.py
+@@ -113,7 +113,7 @@ class Trainer(object):
+             for i in range(self.gradient_accumulate_every):
+                 batch = next(self.dataloader)
+                 batch = batch_to_device(batch, device=self.device)
+-                # breakpoint()
++                breakpoint()
+                 loss, infos = self.model.loss(*batch)
+                 loss = loss / self.gradient_accumulate_every
+                 loss.backward()diff --git a/analysis/default_inv.jsonl b/analysis/default_inv.jsonl
+index 93fd1aa..9d2b695 100644
+--- a/analysis/default_inv.jsonl
++++ b/analysis/default_inv.jsonl
+@@ -1 +1 @@
+-{"RUN.prefix": "diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100", "seed": 100, "returns_condition": true, "predict_epsilon": true, "n_diffusion_steps": 200, "condition_dropout": 0.25, "diffusion": "models.GaussianInvDynDiffusion", "n_train_steps": 1000000.0, "dataset": "hopper-medium-expert-v2", "returns_scale": 400.0, "RUN.job_counter": 1, "RUN.job_name": "predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100"}
++{"RUN.prefix": "diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100", "seed": 100, "returns_condition": true, "predict_epsilon": true, "n_diffusion_steps": 200, "condition_dropout": 0.25, "diffusion": "models.GaussianInvDynDiffusion", "n_train_steps": 1000000.0, "dataset": "hopper-medium-expert-v2", "returns_scale": 400.0, "RUN.job_counter": 1, "RUN.job_name": "predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100"}
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+index 5ff999f..e3fedbc 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+@@ -11634,4 +11634,1428 @@ index db05e5a..53b8e2f 100644
+ +            transition_dim=observation_dim,
+              cond_dim=observation_dim,
+              dim_mults=Config.dim_mults,
+-             returns_condition=Config.returns_condition,
+\ No newline at end of file
++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..53904ea 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
++GIT binary patch
++delta 84
++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
++
++delta 13
++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
++
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..d41a0b9 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++index 5ff999f..38f3578 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++@@ -11634,4 +11634,86 @@ index db05e5a..53b8e2f 100644
++ +            transition_dim=observation_dim,
++              cond_dim=observation_dim,
++              dim_mults=Config.dim_mults,
++-             returns_condition=Config.returns_condition,
++\ No newline at end of file
+++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++index 0136a00..53904ea 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+++ │        loss        │       0.020        │
+++ ╘════════════════════╧════════════════════╛
+++ 
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++    script_path     │ None                
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      counter       │ 2                   
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++       status       │ created             
++++     createTime     │ 2023-12-05 16:58:52.964119
++++════════════════════╧═════════════════════
++++[33m      revision      [0m
++++────────────────────┬─────────────────────
++++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++++       branch       │ refs/heads/main     
++++════════════════════╧═════════════════════
++++[33m         fn         [0m
++++────────────────────┬─────────────────────
++++        name        │ main                
++++        doc         │ None                
++++       module       │ scripts.train       
++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++++════════════════════╧═════════════════════
++++[33m        args        [0m
++++────────────────────┬─────────────────────
++++()
++++════════════════════╧═════════════════════
++++[33m       kwargs       [0m
++++────────────────────┬─────────────────────
++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        seed        │ 100                 
++++ returns_condition  │ True                
++++  predict_epsilon   │ True                
++++ n_diffusion_steps  │ 200                 
++++ condition_dropout  │ 0.25                
++++     diffusion      │ models.GaussianInvDynDiffusion
++++   n_train_steps    │ 1000000.0           
++++      dataset       │ hopper-medium-expert-v2
++++   returns_scale    │ 400.0               
++++  RUN.job_counter   │ 1                   
++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++════════════════════╧═════════════════════
++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
+++GIT binary patch
+++delta 84
+++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
+++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
+++
+++delta 13
+++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
+++
+++diff --git a/analysis/outputs.log b/analysis/outputs.log
+++index b36abbc..d41a0b9 100644
+++--- a/analysis/outputs.log
++++++ b/analysis/outputs.log
+++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+++index 0b6e0bf..a4200ea 100644
+++--- a/diffuser/utils/training.py
++++++ b/diffuser/utils/training.py
+++@@ -113,7 +113,7 @@ class Trainer(object):
+++             for i in range(self.gradient_accumulate_every):
+++                 batch = next(self.dataloader)
+++                 batch = batch_to_device(batch, device=self.device)
+++-                # breakpoint()
++++                breakpoint()
+++                 loss, infos = self.model.loss(*batch)
+++                 loss = loss / self.gradient_accumulate_every
+++                 loss.backward()
++\ No newline at end of file
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
++index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..6f13a7941ab36998ac949d345b5116109a90f9c7 100644
++GIT binary patch
++delta 13
++UcmZ21zCwJ%Vs6$3mf9(L03wzIpa1{>
++
++delta 7
++OcmZ1>zF2(2Vr~Eo6$01*
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..6943886 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,191 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       job_id       │ None                
+++       status       │ started             
+++     startTime      │ 2023-12-05 16:58:52.993286
+++════════════════════╧═════════════════════
+++[33m        host        [0m
+++────────────────────┬─────────────────────
+++      hostname      │ vll-weiyuan         
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m       Config       [0m
+++────────────────────┬─────────────────────
+++        seed        │ 100                 
+++       device       │ cuda                
+++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+++      dataset       │ hopper-medium-expert-v2
+++       model        │ models.TemporalUnet 
+++     diffusion      │ models.GaussianInvDynDiffusion
+++      horizon       │ 100                 
+++ n_diffusion_steps  │ 200                 
+++   action_weight    │ 10                  
+++    loss_weights    │ None                
+++   loss_discount    │ 1                   
+++  predict_epsilon   │ True                
+++     dim_mults      │ (1, 4, 8)           
+++ returns_condition  │ True                
+++    calc_energy     │ False               
+++        dim         │ 128                 
+++ condition_dropout  │ 0.25                
+++condition_guidance_w│ 1.2                 
+++      test_ret      │ 0.9                 
+++      renderer      │ utils.MuJoCoRenderer
+++       loader       │ datasets.SequenceDataset
+++     normalizer     │ CDFNormalizer       
+++   preprocess_fns   │ []                  
+++   clip_denoised    │ True                
+++    use_padding     │ True                
+++  include_returns   │ True                
+++      discount      │ 0.99                
+++  max_path_length   │ 1000                
+++     hidden_dim     │ 256                 
+++       ar_inv       │ False               
+++   train_only_inv   │ False               
+++termination_penalty │ -100                
+++   returns_scale    │ 400.0               
+++ n_steps_per_epoch  │ 10000               
+++     loss_type      │ l2                  
+++   n_train_steps    │ 1000000.0           
+++     batch_size     │ 32                  
+++   learning_rate    │ 0.0002              
+++gradient_accumulate_every│ 2                   
+++     ema_decay      │ 0.995               
+++      log_freq      │ 1000                
+++     save_freq      │ 10000               
+++    sample_freq     │ 10000               
+++      n_saves       │ 5                   
+++   save_parallel    │ False               
+++    n_reference     │ 8                   
+++  save_checkpoints  │ False               
+++════════════════════╧═════════════════════
+++[33m        RUN         [0m
+++────────────────────┬─────────────────────
+++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      username      │ yanyangji           
+++      project       │ diffuser            
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++    script_path     │ None                
+++        now         │ 2023-12-06 00:58:50.921304+08:00
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++    job_counter     │ 1                   
+++       resume       │ True                
+++       readme       │ None                
+++       debug        │ False               
+++CUDA_VISIBLE_DEVICES│ None                
+++     file_stem      │ train               
+++════════════════════╧═════════════════════
+++Testing forward... ✓
+++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
+++
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       status       │ errored             
+++     errorTime      │ 2023-12-05 17:05:07.186644
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-06 02:50:33.911493
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0155f5d4aa158f490a1eb2ecebfe3c179f54a7f1 100644
++GIT binary patch
++delta 217
++zcmYMuu}T9$5P)HJ!7327)GAt~I%Z~PXLh#I#`oCU%YjycFJNJpGJ=m_p9@@JEdj9+
++zeF2{&Q5*Z8kAJ(I?4Bq04{qbPujB2Dzjjl}G37{&2_xF-`|)Hhm@2dOT_H$VD)*&;
++zkQuRR*An*CL_-}v*8bf83l=EJaQS|5a3nK;KNuP#3^1Nux#A8{GsFzqU=m>-+~<w^
++uZ7D~{AvA`__Jnu-bY5G4ilHl_G4+ORBE*h#A<9}4|NJh1QHJBUFSiG@F*_~*
++
++delta 13
++Ucmeyrocnk;cS8%~7N+Az0WK5<RsaA1
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++index 9a48946..0b164e7 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++@@ -1019,3 +1019,17 @@ Traceback (most recent call last):
++   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
++     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
++ AttributeError: 'tuple' object has no attribute 'float'
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..8658a70 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,5 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/config/locomotion_config.py b/config/locomotion_config.py
++index 7c6d244..314d783 100644
++--- a/config/locomotion_config.py
+++++ b/config/locomotion_config.py
++@@ -6,7 +6,7 @@ class Config(ParamsProto):
++     # misc
++     seed = 100
++     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
++-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
++ 
++     ## model
++diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
++index 43dfdbf..adc2a19 100644
++--- a/diffuser/models/diffusion.py
+++++ b/diffuser/models/diffusion.py
++@@ -3,6 +3,7 @@ import torch
++ from torch import nn
++ import torch.nn.functional as F
++ import pdb
+++import clip
++ from config.locomotion_config import Config
++ 
++ import diffuser.utils as utils
++@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
++         self.model = model
++         self.ar_inv = ar_inv
++         self.train_only_inv = train_only_inv
+++        self.device = Config.device
++ 
++         # Text embedding
++-        device = Config.device
++-        self.proj_layer = nn.Linear(512, self.observation_dim)
+++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
+++        self.text_encoder.float()
++ 
++         if self.ar_inv:
++             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++index 5ff999f..40ff74e 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++@@ -11634,4 +11634,480 @@ index db05e5a..53b8e2f 100644
++ +            transition_dim=observation_dim,
++              cond_dim=observation_dim,
++              dim_mults=Config.dim_mults,
++-             returns_condition=Config.returns_condition,
++\ No newline at end of file
+++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++index 0136a00..53904ea 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+++ │        loss        │       0.020        │
+++ ╘════════════════════╧════════════════════╛
+++ 
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++    script_path     │ None                
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      counter       │ 2                   
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++       status       │ created             
++++     createTime     │ 2023-12-05 16:58:52.964119
++++════════════════════╧═════════════════════
++++[33m      revision      [0m
++++────────────────────┬─────────────────────
++++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++++       branch       │ refs/heads/main     
++++════════════════════╧═════════════════════
++++[33m         fn         [0m
++++────────────────────┬─────────────────────
++++        name        │ main                
++++        doc         │ None                
++++       module       │ scripts.train       
++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++++════════════════════╧═════════════════════
++++[33m        args        [0m
++++────────────────────┬─────────────────────
++++()
++++════════════════════╧═════════════════════
++++[33m       kwargs       [0m
++++────────────────────┬─────────────────────
++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        seed        │ 100                 
++++ returns_condition  │ True                
++++  predict_epsilon   │ True                
++++ n_diffusion_steps  │ 200                 
++++ condition_dropout  │ 0.25                
++++     diffusion      │ models.GaussianInvDynDiffusion
++++   n_train_steps    │ 1000000.0           
++++      dataset       │ hopper-medium-expert-v2
++++   returns_scale    │ 400.0               
++++  RUN.job_counter   │ 1                   
++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++════════════════════╧═════════════════════
++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
+++GIT binary patch
+++delta 84
+++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
+++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
+++
+++delta 13
+++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
+++
+++diff --git a/analysis/outputs.log b/analysis/outputs.log
+++index b36abbc..d41a0b9 100644
+++--- a/analysis/outputs.log
++++++ b/analysis/outputs.log
+++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+++index 0b6e0bf..a4200ea 100644
+++--- a/diffuser/utils/training.py
++++++ b/diffuser/utils/training.py
+++@@ -113,7 +113,7 @@ class Trainer(object):
+++             for i in range(self.gradient_accumulate_every):
+++                 batch = next(self.dataloader)
+++                 batch = batch_to_device(batch, device=self.device)
+++-                # breakpoint()
++++                breakpoint()
+++                 loss, infos = self.model.loss(*batch)
+++                 loss = loss / self.gradient_accumulate_every
+++                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++index 5ff999f..38f3578 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++@@ -11634,4 +11634,86 @@ index db05e5a..53b8e2f 100644
+++ +            transition_dim=observation_dim,
+++              cond_dim=observation_dim,
+++              dim_mults=Config.dim_mults,
+++-             returns_condition=Config.returns_condition,
+++\ No newline at end of file
++++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++index 0136a00..53904ea 100644
++++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++++ │        loss        │       0.020        │
++++ ╘════════════════════╧════════════════════╛
++++ 
+++++══════════════════════════════════════════
+++++[33m        job         [0m
+++++────────────────────┬─────────────────────
+++++    script_path     │ None                
+++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++++      counter       │ 2                   
+++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++++       status       │ created             
+++++     createTime     │ 2023-12-05 16:58:52.964119
+++++════════════════════╧═════════════════════
+++++[33m      revision      [0m
+++++────────────────────┬─────────────────────
+++++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++++       branch       │ refs/heads/main     
+++++════════════════════╧═════════════════════
+++++[33m         fn         [0m
+++++────────────────────┬─────────────────────
+++++        name        │ main                
+++++        doc         │ None                
+++++       module       │ scripts.train       
+++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++++════════════════════╧═════════════════════
+++++[33m        args        [0m
+++++────────────────────┬─────────────────────
+++++()
+++++════════════════════╧═════════════════════
+++++[33m       kwargs       [0m
+++++────────────────────┬─────────────────────
+++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++++        seed        │ 100                 
+++++ returns_condition  │ True                
+++++  predict_epsilon   │ True                
+++++ n_diffusion_steps  │ 200                 
+++++ condition_dropout  │ 0.25                
+++++     diffusion      │ models.GaussianInvDynDiffusion
+++++   n_train_steps    │ 1000000.0           
+++++      dataset       │ hopper-medium-expert-v2
+++++   returns_scale    │ 400.0               
+++++  RUN.job_counter   │ 1                   
+++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++++════════════════════╧═════════════════════
+++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
++++GIT binary patch
++++delta 84
++++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
++++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
++++
++++delta 13
++++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
++++
++++diff --git a/analysis/outputs.log b/analysis/outputs.log
++++index b36abbc..d41a0b9 100644
++++--- a/analysis/outputs.log
+++++++ b/analysis/outputs.log
++++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++++index 0b6e0bf..a4200ea 100644
++++--- a/diffuser/utils/training.py
+++++++ b/diffuser/utils/training.py
++++@@ -113,7 +113,7 @@ class Trainer(object):
++++             for i in range(self.gradient_accumulate_every):
++++                 batch = next(self.dataloader)
++++                 batch = batch_to_device(batch, device=self.device)
++++-                # breakpoint()
+++++                breakpoint()
++++                 loss, infos = self.model.loss(*batch)
++++                 loss = loss / self.gradient_accumulate_every
++++                 loss.backward()
+++\ No newline at end of file
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
+++index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..6f13a7941ab36998ac949d345b5116109a90f9c7 100644
+++GIT binary patch
+++delta 13
+++UcmZ21zCwJ%Vs6$3mf9(L03wzIpa1{>
+++
+++delta 7
+++OcmZ1>zF2(2Vr~Eo6$01*
+++
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++index 0136a00..6943886 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++@@ -10016,3 +10016,191 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+++ │        loss        │       0.020        │
+++ ╘════════════════════╧════════════════════╛
+++ 
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++    script_path     │ None                
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      counter       │ 2                   
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++       status       │ created             
++++     createTime     │ 2023-12-05 16:58:52.964119
++++════════════════════╧═════════════════════
++++[33m      revision      [0m
++++────────────────────┬─────────────────────
++++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++++       branch       │ refs/heads/main     
++++════════════════════╧═════════════════════
++++[33m         fn         [0m
++++────────────────────┬─────────────────────
++++        name        │ main                
++++        doc         │ None                
++++       module       │ scripts.train       
++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++++════════════════════╧═════════════════════
++++[33m        args        [0m
++++────────────────────┬─────────────────────
++++()
++++════════════════════╧═════════════════════
++++[33m       kwargs       [0m
++++────────────────────┬─────────────────────
++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        seed        │ 100                 
++++ returns_condition  │ True                
++++  predict_epsilon   │ True                
++++ n_diffusion_steps  │ 200                 
++++ condition_dropout  │ 0.25                
++++     diffusion      │ models.GaussianInvDynDiffusion
++++   n_train_steps    │ 1000000.0           
++++      dataset       │ hopper-medium-expert-v2
++++   returns_scale    │ 400.0               
++++  RUN.job_counter   │ 1                   
++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++════════════════════╧═════════════════════
++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++       job_id       │ None                
++++       status       │ started             
++++     startTime      │ 2023-12-05 16:58:52.993286
++++════════════════════╧═════════════════════
++++[33m        host        [0m
++++────────────────────┬─────────────────────
++++      hostname      │ vll-weiyuan         
++++════════════════════╧═════════════════════
++++══════════════════════════════════════════
++++[33m       Config       [0m
++++────────────────────┬─────────────────────
++++        seed        │ 100                 
++++       device       │ cuda                
++++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++++      dataset       │ hopper-medium-expert-v2
++++       model        │ models.TemporalUnet 
++++     diffusion      │ models.GaussianInvDynDiffusion
++++      horizon       │ 100                 
++++ n_diffusion_steps  │ 200                 
++++   action_weight    │ 10                  
++++    loss_weights    │ None                
++++   loss_discount    │ 1                   
++++  predict_epsilon   │ True                
++++     dim_mults      │ (1, 4, 8)           
++++ returns_condition  │ True                
++++    calc_energy     │ False               
++++        dim         │ 128                 
++++ condition_dropout  │ 0.25                
++++condition_guidance_w│ 1.2                 
++++      test_ret      │ 0.9                 
++++      renderer      │ utils.MuJoCoRenderer
++++       loader       │ datasets.SequenceDataset
++++     normalizer     │ CDFNormalizer       
++++   preprocess_fns   │ []                  
++++   clip_denoised    │ True                
++++    use_padding     │ True                
++++  include_returns   │ True                
++++      discount      │ 0.99                
++++  max_path_length   │ 1000                
++++     hidden_dim     │ 256                 
++++       ar_inv       │ False               
++++   train_only_inv   │ False               
++++termination_penalty │ -100                
++++   returns_scale    │ 400.0               
++++ n_steps_per_epoch  │ 10000               
++++     loss_type      │ l2                  
++++   n_train_steps    │ 1000000.0           
++++     batch_size     │ 32                  
++++   learning_rate    │ 0.0002              
++++gradient_accumulate_every│ 2                   
++++     ema_decay      │ 0.995               
++++      log_freq      │ 1000                
++++     save_freq      │ 10000               
++++    sample_freq     │ 10000               
++++      n_saves       │ 5                   
++++   save_parallel    │ False               
++++    n_reference     │ 8                   
++++  save_checkpoints  │ False               
++++════════════════════╧═════════════════════
++++[33m        RUN         [0m
++++────────────────────┬─────────────────────
++++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      username      │ yanyangji           
++++      project       │ diffuser            
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++    script_path     │ None                
++++        now         │ 2023-12-06 00:58:50.921304+08:00
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++    job_counter     │ 1                   
++++       resume       │ True                
++++       readme       │ None                
++++       debug        │ False               
++++CUDA_VISIBLE_DEVICES│ None                
++++     file_stem      │ train               
++++════════════════════╧═════════════════════
++++Testing forward... ✓
++++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++Traceback (most recent call last):
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++++    results = fn(*(args or ARGS), **_KWARGS)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++++    loss, infos = self.model.loss(*batch)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++++    loss, infos = self.model.loss(*batch)
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++++    return self.dispatch_line(frame)
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++++    if self.quitting: raise BdbQuit
++++bdb.BdbQuit
++++
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++       status       │ errored             
++++     errorTime      │ 2023-12-05 17:05:07.186644
++++════════════════════╧═════════════════════
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++    script_path     │ None                
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      counter       │ 2                   
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++       status       │ created             
++++     createTime     │ 2023-12-06 02:50:33.911493
++++════════════════════╧═════════════════════
++++[33m      revision      [0m
++++────────────────────┬─────────────────────
++++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++++       branch       │ refs/heads/main     
++++════════════════════╧═════════════════════
++++[33m         fn         [0m
++++────────────────────┬─────────────────────
++++        name        │ main                
++++        doc         │ None                
++++       module       │ scripts.train       
++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++++════════════════════╧═════════════════════
++++[33m        args        [0m
++++────────────────────┬─────────────────────
++++()
++++════════════════════╧═════════════════════
++++[33m       kwargs       [0m
++++────────────────────┬─────────────────────
++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        seed        │ 100                 
++++ returns_condition  │ True                
++++  predict_epsilon   │ True                
++++ n_diffusion_steps  │ 200                 
++++ condition_dropout  │ 0.25                
++++     diffusion      │ models.GaussianInvDynDiffusion
++++   n_train_steps    │ 1000000.0           
++++      dataset       │ hopper-medium-expert-v2
++++   returns_scale    │ 400.0               
++++  RUN.job_counter   │ 1                   
++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++════════════════════╧═════════════════════
++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0155f5d4aa158f490a1eb2ecebfe3c179f54a7f1 100644
+++GIT binary patch
+++delta 217
+++zcmYMuu}T9$5P)HJ!7327)GAt~I%Z~PXLh#I#`oCU%YjycFJNJpGJ=m_p9@@JEdj9+
+++zeF2{&Q5*Z8kAJ(I?4Bq04{qbPujB2Dzjjl}G37{&2_xF-`|)Hhm@2dOT_H$VD)*&;
+++zkQuRR*An*CL_-}v*8bf83l=EJaQS|5a3nK;KNuP#3^1Nux#A8{GsFzqU=m>-+~<w^
+++uZ7D~{AvA`__Jnu-bY5G4ilHl_G4+ORBE*h#A<9}4|NJh1QHJBUFSiG@F*_~*
+++
+++delta 13
+++Ucmeyrocnk;cS8%~7N+Az0WK5<RsaA1
+++
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++index 9a48946..0b164e7 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++@@ -1019,3 +1019,17 @@ Traceback (most recent call last):
+++   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
+++     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
+++ AttributeError: 'tuple' object has no attribute 'float'
++++Traceback (most recent call last):
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++++    results = fn(*(args or ARGS), **_KWARGS)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++++    loss, infos = self.model.loss(*batch)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++++    loss, infos = self.model.loss(*batch)
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++++    return self.dispatch_line(frame)
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++++    if self.quitting: raise BdbQuit
++++bdb.BdbQuit
+++diff --git a/analysis/outputs.log b/analysis/outputs.log
+++index b36abbc..8658a70 100644
+++--- a/analysis/outputs.log
++++++ b/analysis/outputs.log
+++@@ -65,3 +65,5 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diff --git a/config/locomotion_config.py b/config/locomotion_config.py
+++index 7c6d244..314d783 100644
+++--- a/config/locomotion_config.py
++++++ b/config/locomotion_config.py
+++@@ -6,7 +6,7 @@ class Config(ParamsProto):
+++     # misc
+++     seed = 100
+++     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
+++-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+++     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
+++ 
+++     ## model
+++diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
+++index 43dfdbf..adc2a19 100644
+++--- a/diffuser/models/diffusion.py
++++++ b/diffuser/models/diffusion.py
+++@@ -3,6 +3,7 @@ import torch
+++ from torch import nn
+++ import torch.nn.functional as F
+++ import pdb
++++import clip
+++ from config.locomotion_config import Config
+++ 
+++ import diffuser.utils as utils
+++@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
+++         self.model = model
+++         self.ar_inv = ar_inv
+++         self.train_only_inv = train_only_inv
++++        self.device = Config.device
+++ 
+++         # Text embedding
+++-        device = Config.device
+++-        self.proj_layer = nn.Linear(512, self.observation_dim)
++++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
++++        self.text_encoder.float()
+++ 
+++         if self.ar_inv:
+++             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
+++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+++index 0b6e0bf..a4200ea 100644
+++--- a/diffuser/utils/training.py
++++++ b/diffuser/utils/training.py
+++@@ -113,7 +113,7 @@ class Trainer(object):
+++             for i in range(self.gradient_accumulate_every):
+++                 batch = next(self.dataloader)
+++                 batch = batch_to_device(batch, device=self.device)
+++-                # breakpoint()
++++                breakpoint()
+++                 loss, infos = self.model.loss(*batch)
+++                 loss = loss / self.gradient_accumulate_every
+++                 loss.backward()
++\ No newline at end of file
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
++index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..c1d221b35a1e6e7cab20fdd218448b73984a7b8f 100644
++GIT binary patch
++delta 18
++WcmZ21zE*t0Vs5Smmf9(LU;+R?ng(qE
++
++delta 7
++OcmZ20zF2(2Vr~EoI0D@O
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..93fce68 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,334 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       job_id       │ None                
+++       status       │ started             
+++     startTime      │ 2023-12-05 16:58:52.993286
+++════════════════════╧═════════════════════
+++[33m        host        [0m
+++────────────────────┬─────────────────────
+++      hostname      │ vll-weiyuan         
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m       Config       [0m
+++────────────────────┬─────────────────────
+++        seed        │ 100                 
+++       device       │ cuda                
+++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+++      dataset       │ hopper-medium-expert-v2
+++       model        │ models.TemporalUnet 
+++     diffusion      │ models.GaussianInvDynDiffusion
+++      horizon       │ 100                 
+++ n_diffusion_steps  │ 200                 
+++   action_weight    │ 10                  
+++    loss_weights    │ None                
+++   loss_discount    │ 1                   
+++  predict_epsilon   │ True                
+++     dim_mults      │ (1, 4, 8)           
+++ returns_condition  │ True                
+++    calc_energy     │ False               
+++        dim         │ 128                 
+++ condition_dropout  │ 0.25                
+++condition_guidance_w│ 1.2                 
+++      test_ret      │ 0.9                 
+++      renderer      │ utils.MuJoCoRenderer
+++       loader       │ datasets.SequenceDataset
+++     normalizer     │ CDFNormalizer       
+++   preprocess_fns   │ []                  
+++   clip_denoised    │ True                
+++    use_padding     │ True                
+++  include_returns   │ True                
+++      discount      │ 0.99                
+++  max_path_length   │ 1000                
+++     hidden_dim     │ 256                 
+++       ar_inv       │ False               
+++   train_only_inv   │ False               
+++termination_penalty │ -100                
+++   returns_scale    │ 400.0               
+++ n_steps_per_epoch  │ 10000               
+++     loss_type      │ l2                  
+++   n_train_steps    │ 1000000.0           
+++     batch_size     │ 32                  
+++   learning_rate    │ 0.0002              
+++gradient_accumulate_every│ 2                   
+++     ema_decay      │ 0.995               
+++      log_freq      │ 1000                
+++     save_freq      │ 10000               
+++    sample_freq     │ 10000               
+++      n_saves       │ 5                   
+++   save_parallel    │ False               
+++    n_reference     │ 8                   
+++  save_checkpoints  │ False               
+++════════════════════╧═════════════════════
+++[33m        RUN         [0m
+++────────────────────┬─────────────────────
+++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      username      │ yanyangji           
+++      project       │ diffuser            
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++    script_path     │ None                
+++        now         │ 2023-12-06 00:58:50.921304+08:00
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++    job_counter     │ 1                   
+++       resume       │ True                
+++       readme       │ None                
+++       debug        │ False               
+++CUDA_VISIBLE_DEVICES│ None                
+++     file_stem      │ train               
+++════════════════════╧═════════════════════
+++Testing forward... ✓
+++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
+++
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       status       │ errored             
+++     errorTime      │ 2023-12-05 17:05:07.186644
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-06 02:50:33.911493
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       job_id       │ None                
+++       status       │ started             
+++     startTime      │ 2023-12-06 02:50:33.953978
+++════════════════════╧═════════════════════
+++[33m        host        [0m
+++────────────────────┬─────────────────────
+++      hostname      │ vll-weiyuan         
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m       Config       [0m
+++────────────────────┬─────────────────────
+++        seed        │ 100                 
+++       device       │ cuda                
+++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+++      dataset       │ hopper-medium-expert-v2
+++       model        │ models.TemporalUnet 
+++     diffusion      │ models.GaussianInvDynDiffusion
+++      horizon       │ 100                 
+++ n_diffusion_steps  │ 200                 
+++   action_weight    │ 10                  
+++    loss_weights    │ None                
+++   loss_discount    │ 1                   
+++  predict_epsilon   │ True                
+++     dim_mults      │ (1, 4, 8)           
+++ returns_condition  │ True                
+++    calc_energy     │ False               
+++        dim         │ 128                 
+++ condition_dropout  │ 0.25                
+++condition_guidance_w│ 1.2                 
+++      test_ret      │ 0.9                 
+++      renderer      │ utils.MuJoCoRenderer
+++       loader       │ datasets.SequenceDataset
+++     normalizer     │ CDFNormalizer       
+++   preprocess_fns   │ []                  
+++   clip_denoised    │ True                
+++    use_padding     │ True                
+++  include_returns   │ True                
+++      discount      │ 0.99                
+++  max_path_length   │ 1000                
+++     hidden_dim     │ 256                 
+++       ar_inv       │ False               
+++   train_only_inv   │ False               
+++termination_penalty │ -100                
+++   returns_scale    │ 400.0               
+++ n_steps_per_epoch  │ 10000               
+++     loss_type      │ l2                  
+++   n_train_steps    │ 1000000.0           
+++     batch_size     │ 32                  
+++   learning_rate    │ 0.0002              
+++gradient_accumulate_every│ 2                   
+++     ema_decay      │ 0.995               
+++      log_freq      │ 1000                
+++     save_freq      │ 10000               
+++    sample_freq     │ 10000               
+++      n_saves       │ 5                   
+++   save_parallel    │ False               
+++    n_reference     │ 8                   
+++  save_checkpoints  │ False               
+++════════════════════╧═════════════════════
+++[33m        RUN         [0m
+++────────────────────┬─────────────────────
+++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      username      │ yanyangji           
+++      project       │ diffuser            
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++    script_path     │ None                
+++        now         │ 2023-12-06 10:50:31.778840+08:00
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++    job_counter     │ 1                   
+++       resume       │ True                
+++       readme       │ None                
+++       debug        │ False               
+++CUDA_VISIBLE_DEVICES│ None                
+++     file_stem      │ train               
+++════════════════════╧═════════════════════
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+++    dataset = dataset_config()
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+++    instance = self._class(*args, **kwargs, **self._dict)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+++    for i, episode in enumerate(itr):
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+++    target_task = list(env.tasks_to_complete)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+++    return getattr(self._wrapped_env, attr)
+++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+++
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       status       │ errored             
+++     errorTime      │ 2023-12-06 02:50:35.849523
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-06 02:54:15.281510
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0a8eca6f0943babca69daf94ba5186278e81a2fa 100644
++GIT binary patch
++delta 357
++zcmb7=u}T9$6h)bVQ~@=OppDTgAPn!#ym@bCDs9r|2ZY_(ENCV80~UgXWrTc$ohxi1
++zmJ$#f(I4;&`~}w~AeOe5%ejZUx*6U*4KJ_MgI+zi=a2eSZE*4-d21pQVqARQ?o1d%
++zCX%`;ECehv)kOhpW3(hvl@{w9SzK=4?)8EGB}8WfH^;9>gDoBd^k6X2qJwsSstUD<
++zlE5brgMpc-QSWE!r)!gk<eZ6!6qk6RcPF_7$mptq#fLg#87yLDWzIs919iT0AmnEB
++zvZwzryo<7!Ef1S7*&d8|jGakGM<WsfK{LBPQC++q^`>Ka>w1@UObNZQ0X;&0$Uj^@
++F)Hlu|UN8Uv
++
++delta 13
++UcmZ3zm-~1(cS8%~7N+Az0V>!A7ytkO
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++index 9a48946..4a0b118 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++@@ -1019,3 +1019,31 @@ Traceback (most recent call last):
++   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
++     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
++ AttributeError: 'tuple' object has no attribute 'float'
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+++    dataset = dataset_config()
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+++    instance = self._class(*args, **kwargs, **self._dict)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+++    for i, episode in enumerate(itr):
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+++    target_task = list(env.tasks_to_complete)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+++    return getattr(self._wrapped_env, attr)
+++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..6c7de88 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,6 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/config/locomotion_config.py b/config/locomotion_config.py
++index 7c6d244..314d783 100644
++--- a/config/locomotion_config.py
+++++ b/config/locomotion_config.py
++@@ -6,7 +6,7 @@ class Config(ParamsProto):
++     # misc
++     seed = 100
++     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
++-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
++ 
++     ## model
++diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
++index 43dfdbf..adc2a19 100644
++--- a/diffuser/models/diffusion.py
+++++ b/diffuser/models/diffusion.py
++@@ -3,6 +3,7 @@ import torch
++ from torch import nn
++ import torch.nn.functional as F
++ import pdb
+++import clip
++ from config.locomotion_config import Config
++ 
++ import diffuser.utils as utils
++@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
++         self.model = model
++         self.ar_inv = ar_inv
++         self.train_only_inv = train_only_inv
+++        self.device = Config.device
++ 
++         # Text embedding
++-        device = Config.device
++-        self.proj_layer = nn.Linear(512, self.observation_dim)
+++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
+++        self.text_encoder.float()
++ 
++         if self.ar_inv:
++             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()
+\ No newline at end of file
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
+index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..dfcc151ff6bd7034ec077a18c06a9c99c74c2262 100644
+GIT binary patch
+delta 11
+ScmZ21zDaz;V(!ULS@{7R*#vF?
+
+delta 7
+OcmdlazF2(2Vr~EoTLR($
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+index 0136a00..43ce3af 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+@@ -10016,3 +10016,477 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+ │        loss        │       0.020        │
+ ╘════════════════════╧════════════════════╛
+ 
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-05 16:58:52.964119
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-05 16:58:52.993286
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 00:58:50.921304+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Testing forward... ✓
++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-05 17:05:07.186644
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-06 02:50:33.911493
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-06 02:50:33.953978
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 10:50:31.778840+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-06 02:50:35.849523
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-06 02:54:15.281510
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-06 02:54:15.328619
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 10:54:13.139864+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-06 02:54:17.280334
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
++       status       │ created             
++     createTime     │ 2023-12-06 03:05:11.350342
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..092c080a008bcec38e566f776b324cb44e80450d 100644
+GIT binary patch
+delta 527
+zcmbV|y-EW?6h@iFQ~{G92(d9*1ww{<=YO`*H1>G`akIO@D2fmju}UFWSZ+ez!xgr$
+zmVj9JR||Q9yn>TWKrFRAT+Tgwle^;UdvS0>9=yp@cJ}D?$g1+C@g<{H2}GMrht;}5
+z6AGcbQNX}p5Q=UPfMV7%p>@<@*bS}HJj~wiy>0KuU^z1?ZN2Ok%BlvCi-B5(9I~xF
+z5|9#VAEXbOqESkSlzbeK`7QG$_?%OVDC`*f-bOv_0EEb+Kxt{Z7CVL^Moh;_3mqEa
+zdSei%(#rFu_sb!<)k%BYNN0MzP*F8>CC-jiYhwhY?c06g@bamo&LtVoTb5Y(C@C{2
+z5%NL)(~>*pgJ9Mkd96Ze5#lhX$gRn0d*pyr7afjj_YgQ2!;3y0tc<RcDW8#@WV+TU
+jANS6~!}zp$(z}YI=A~=;f_W*QkBLaR1TNTLOFzjsX}OJZ
+
+delta 13
+Ucmca`iTijrcS8%~7N+Az0WGx#QUCw|
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+index 9a48946..db58e91 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+@@ -1019,3 +1019,45 @@ Traceback (most recent call last):
+   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
+     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
+ AttributeError: 'tuple' object has no attribute 'float'
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+diff --git a/analysis/outputs.log b/analysis/outputs.log
+index b36abbc..6f9fa2b 100644
+--- a/analysis/outputs.log
++++ b/analysis/outputs.log
+@@ -65,3 +65,7 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diff --git a/config/locomotion_config.py b/config/locomotion_config.py
+index 7c6d244..314d783 100644
+--- a/config/locomotion_config.py
++++ b/config/locomotion_config.py
+@@ -6,7 +6,7 @@ class Config(ParamsProto):
+     # misc
+     seed = 100
+     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
+-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
+ 
+     ## model
+diff --git a/diffuser/datasets/sequence.py b/diffuser/datasets/sequence.py
+index 7aa43ce..315a7fd 100644
+--- a/diffuser/datasets/sequence.py
++++ b/diffuser/datasets/sequence.py
+@@ -15,7 +15,7 @@ ValueBatch = namedtuple('ValueBatch', 'trajectories conditions values')
+         
+ class SequenceDataset(torch.utils.data.Dataset):
+ 
+-    def __init__(self, env='hopper-medium-replay', horizon=64,
++    def __init__(self, env='kitchen-mixed-v0', horizon=64,
+         normalizer='LimitsNormalizer', preprocess_fns=[], max_path_length=1000,
+         max_n_episodes=10000, termination_penalty=0, use_padding=True, discount=0.99, returns_scale=1000, include_returns=False):
+         self.preprocess_fn = get_preprocess_fn(preprocess_fns, env)
+diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
+index 43dfdbf..adc2a19 100644
+--- a/diffuser/models/diffusion.py
++++ b/diffuser/models/diffusion.py
+@@ -3,6 +3,7 @@ import torch
+ from torch import nn
+ import torch.nn.functional as F
+ import pdb
++import clip
+ from config.locomotion_config import Config
+ 
+ import diffuser.utils as utils
+@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
+         self.model = model
+         self.ar_inv = ar_inv
+         self.train_only_inv = train_only_inv
++        self.device = Config.device
+ 
+         # Text embedding
+-        device = Config.device
+-        self.proj_layer = nn.Linear(512, self.observation_dim)
++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
++        self.text_encoder.float()
+ 
+         if self.ar_inv:
+             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
+diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+index 0b6e0bf..a4200ea 100644
+--- a/diffuser/utils/training.py
++++ b/diffuser/utils/training.py
+@@ -113,7 +113,7 @@ class Trainer(object):
+             for i in range(self.gradient_accumulate_every):
+                 batch = next(self.dataloader)
+                 batch = batch_to_device(batch, device=self.device)
+-                # breakpoint()
++                breakpoint()
+                 loss, infos = self.model.loss(*batch)
+                 loss = loss / self.gradient_accumulate_every
+                 loss.backward()
\ No newline at end of file
diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..3ede48a0e512b82aebeb11a518f77b6f7ca03fc5 100644
GIT binary patch
delta 11
ScmZ21zFmC7V(!ULSw#RH3j}xo

delta 7
OcmdlkzF2(2Vr~EoegfwJ

diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
index 0136a00..8a56a31 100644
--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
@@ -10016,3 +10016,577 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
 │        loss        │       0.020        │
 ╘════════════════════╧════════════════════╛
 
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+    script_path     │ None                
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      counter       │ 2                   
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+       status       │ created             
+     createTime     │ 2023-12-05 16:58:52.964119
+════════════════════╧═════════════════════
+[33m      revision      [0m
+────────────────────┬─────────────────────
+        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+       branch       │ refs/heads/main     
+════════════════════╧═════════════════════
+[33m         fn         [0m
+────────────────────┬─────────────────────
+        name        │ main                
+        doc         │ None                
+       module       │ scripts.train       
+        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+════════════════════╧═════════════════════
+[33m        args        [0m
+────────────────────┬─────────────────────
+()
+════════════════════╧═════════════════════
+[33m       kwargs       [0m
+────────────────────┬─────────────────────
+     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        seed        │ 100                 
+ returns_condition  │ True                
+  predict_epsilon   │ True                
+ n_diffusion_steps  │ 200                 
+ condition_dropout  │ 0.25                
+     diffusion      │ models.GaussianInvDynDiffusion
+   n_train_steps    │ 1000000.0           
+      dataset       │ hopper-medium-expert-v2
+   returns_scale    │ 400.0               
+  RUN.job_counter   │ 1                   
+    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+════════════════════╧═════════════════════
+taking diff, if this step takes too long, check if your uncommitted changes are too large.
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       job_id       │ None                
+       status       │ started             
+     startTime      │ 2023-12-05 16:58:52.993286
+════════════════════╧═════════════════════
+[33m        host        [0m
+────────────────────┬─────────────────────
+      hostname      │ vll-weiyuan         
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m       Config       [0m
+────────────────────┬─────────────────────
+        seed        │ 100                 
+       device       │ cuda                
+       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+      dataset       │ hopper-medium-expert-v2
+       model        │ models.TemporalUnet 
+     diffusion      │ models.GaussianInvDynDiffusion
+      horizon       │ 100                 
+ n_diffusion_steps  │ 200                 
+   action_weight    │ 10                  
+    loss_weights    │ None                
+   loss_discount    │ 1                   
+  predict_epsilon   │ True                
+     dim_mults      │ (1, 4, 8)           
+ returns_condition  │ True                
+    calc_energy     │ False               
+        dim         │ 128                 
+ condition_dropout  │ 0.25                
+condition_guidance_w│ 1.2                 
+      test_ret      │ 0.9                 
+      renderer      │ utils.MuJoCoRenderer
+       loader       │ datasets.SequenceDataset
+     normalizer     │ CDFNormalizer       
+   preprocess_fns   │ []                  
+   clip_denoised    │ True                
+    use_padding     │ True                
+  include_returns   │ True                
+      discount      │ 0.99                
+  max_path_length   │ 1000                
+     hidden_dim     │ 256                 
+       ar_inv       │ False               
+   train_only_inv   │ False               
+termination_penalty │ -100                
+   returns_scale    │ 400.0               
+ n_steps_per_epoch  │ 10000               
+     loss_type      │ l2                  
+   n_train_steps    │ 1000000.0           
+     batch_size     │ 32                  
+   learning_rate    │ 0.0002              
+gradient_accumulate_every│ 2                   
+     ema_decay      │ 0.995               
+      log_freq      │ 1000                
+     save_freq      │ 10000               
+    sample_freq     │ 10000               
+      n_saves       │ 5                   
+   save_parallel    │ False               
+    n_reference     │ 8                   
+  save_checkpoints  │ False               
+════════════════════╧═════════════════════
+[33m        RUN         [0m
+────────────────────┬─────────────────────
+       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      username      │ yanyangji           
+      project       │ diffuser            
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+    script_path     │ None                
+        now         │ 2023-12-06 00:58:50.921304+08:00
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+    job_counter     │ 1                   
+       resume       │ True                
+       readme       │ None                
+       debug        │ False               
+CUDA_VISIBLE_DEVICES│ None                
+     file_stem      │ train               
+════════════════════╧═════════════════════
+Testing forward... ✓
+Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+    loss, infos = self.model.loss(*batch)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+    loss, infos = self.model.loss(*batch)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+    return self.dispatch_line(frame)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+    if self.quitting: raise BdbQuit
+bdb.BdbQuit
+
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       status       │ errored             
+     errorTime      │ 2023-12-05 17:05:07.186644
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+    script_path     │ None                
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      counter       │ 2                   
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+       status       │ created             
+     createTime     │ 2023-12-06 02:50:33.911493
+════════════════════╧═════════════════════
+[33m      revision      [0m
+────────────────────┬─────────────────────
+        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+       branch       │ refs/heads/main     
+════════════════════╧═════════════════════
+[33m         fn         [0m
+────────────────────┬─────────────────────
+        name        │ main                
+        doc         │ None                
+       module       │ scripts.train       
+        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+════════════════════╧═════════════════════
+[33m        args        [0m
+────────────────────┬─────────────────────
+()
+════════════════════╧═════════════════════
+[33m       kwargs       [0m
+────────────────────┬─────────────────────
+     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        seed        │ 100                 
+ returns_condition  │ True                
+  predict_epsilon   │ True                
+ n_diffusion_steps  │ 200                 
+ condition_dropout  │ 0.25                
+     diffusion      │ models.GaussianInvDynDiffusion
+   n_train_steps    │ 1000000.0           
+      dataset       │ hopper-medium-expert-v2
+   returns_scale    │ 400.0               
+  RUN.job_counter   │ 1                   
+    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+════════════════════╧═════════════════════
+taking diff, if this step takes too long, check if your uncommitted changes are too large.
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       job_id       │ None                
+       status       │ started             
+     startTime      │ 2023-12-06 02:50:33.953978
+════════════════════╧═════════════════════
+[33m        host        [0m
+────────────────────┬─────────────────────
+      hostname      │ vll-weiyuan         
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m       Config       [0m
+────────────────────┬─────────────────────
+        seed        │ 100                 
+       device       │ cuda                
+       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+      dataset       │ hopper-medium-expert-v2
+       model        │ models.TemporalUnet 
+     diffusion      │ models.GaussianInvDynDiffusion
+      horizon       │ 100                 
+ n_diffusion_steps  │ 200                 
+   action_weight    │ 10                  
+    loss_weights    │ None                
+   loss_discount    │ 1                   
+  predict_epsilon   │ True                
+     dim_mults      │ (1, 4, 8)           
+ returns_condition  │ True                
+    calc_energy     │ False               
+        dim         │ 128                 
+ condition_dropout  │ 0.25                
+condition_guidance_w│ 1.2                 
+      test_ret      │ 0.9                 
+      renderer      │ utils.MuJoCoRenderer
+       loader       │ datasets.SequenceDataset
+     normalizer     │ CDFNormalizer       
+   preprocess_fns   │ []                  
+   clip_denoised    │ True                
+    use_padding     │ True                
+  include_returns   │ True                
+      discount      │ 0.99                
+  max_path_length   │ 1000                
+     hidden_dim     │ 256                 
+       ar_inv       │ False               
+   train_only_inv   │ False               
+termination_penalty │ -100                
+   returns_scale    │ 400.0               
+ n_steps_per_epoch  │ 10000               
+     loss_type      │ l2                  
+   n_train_steps    │ 1000000.0           
+     batch_size     │ 32                  
+   learning_rate    │ 0.0002              
+gradient_accumulate_every│ 2                   
+     ema_decay      │ 0.995               
+      log_freq      │ 1000                
+     save_freq      │ 10000               
+    sample_freq     │ 10000               
+      n_saves       │ 5                   
+   save_parallel    │ False               
+    n_reference     │ 8                   
+  save_checkpoints  │ False               
+════════════════════╧═════════════════════
+[33m        RUN         [0m
+────────────────────┬─────────────────────
+       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      username      │ yanyangji           
+      project       │ diffuser            
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+    script_path     │ None                
+        now         │ 2023-12-06 10:50:31.778840+08:00
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+    job_counter     │ 1                   
+       resume       │ True                
+       readme       │ None                
+       debug        │ False               
+CUDA_VISIBLE_DEVICES│ None                
+     file_stem      │ train               
+════════════════════╧═════════════════════
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       status       │ errored             
+     errorTime      │ 2023-12-06 02:50:35.849523
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+    script_path     │ None                
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      counter       │ 2                   
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+       status       │ created             
+     createTime     │ 2023-12-06 02:54:15.281510
+════════════════════╧═════════════════════
+[33m      revision      [0m
+────────────────────┬─────────────────────
+        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+       branch       │ refs/heads/main     
+════════════════════╧═════════════════════
+[33m         fn         [0m
+────────────────────┬─────────────────────
+        name        │ main                
+        doc         │ None                
+       module       │ scripts.train       
+        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+════════════════════╧═════════════════════
+[33m        args        [0m
+────────────────────┬─────────────────────
+()
+════════════════════╧═════════════════════
+[33m       kwargs       [0m
+────────────────────┬─────────────────────
+     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        seed        │ 100                 
+ returns_condition  │ True                
+  predict_epsilon   │ True                
+ n_diffusion_steps  │ 200                 
+ condition_dropout  │ 0.25                
+     diffusion      │ models.GaussianInvDynDiffusion
+   n_train_steps    │ 1000000.0           
+      dataset       │ hopper-medium-expert-v2
+   returns_scale    │ 400.0               
+  RUN.job_counter   │ 1                   
+    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+════════════════════╧═════════════════════
+taking diff, if this step takes too long, check if your uncommitted changes are too large.
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       job_id       │ None                
+       status       │ started             
+     startTime      │ 2023-12-06 02:54:15.328619
+════════════════════╧═════════════════════
+[33m        host        [0m
+────────────────────┬─────────────────────
+      hostname      │ vll-weiyuan         
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m       Config       [0m
+────────────────────┬─────────────────────
+        seed        │ 100                 
+       device       │ cuda                
+       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+      dataset       │ hopper-medium-expert-v2
+       model        │ models.TemporalUnet 
+     diffusion      │ models.GaussianInvDynDiffusion
+      horizon       │ 100                 
+ n_diffusion_steps  │ 200                 
+   action_weight    │ 10                  
+    loss_weights    │ None                
+   loss_discount    │ 1                   
+  predict_epsilon   │ True                
+     dim_mults      │ (1, 4, 8)           
+ returns_condition  │ True                
+    calc_energy     │ False               
+        dim         │ 128                 
+ condition_dropout  │ 0.25                
+condition_guidance_w│ 1.2                 
+      test_ret      │ 0.9                 
+      renderer      │ utils.MuJoCoRenderer
+       loader       │ datasets.SequenceDataset
+     normalizer     │ CDFNormalizer       
+   preprocess_fns   │ []                  
+   clip_denoised    │ True                
+    use_padding     │ True                
+  include_returns   │ True                
+      discount      │ 0.99                
+  max_path_length   │ 1000                
+     hidden_dim     │ 256                 
+       ar_inv       │ False               
+   train_only_inv   │ False               
+termination_penalty │ -100                
+   returns_scale    │ 400.0               
+ n_steps_per_epoch  │ 10000               
+     loss_type      │ l2                  
+   n_train_steps    │ 1000000.0           
+     batch_size     │ 32                  
+   learning_rate    │ 0.0002              
+gradient_accumulate_every│ 2                   
+     ema_decay      │ 0.995               
+      log_freq      │ 1000                
+     save_freq      │ 10000               
+    sample_freq     │ 10000               
+      n_saves       │ 5                   
+   save_parallel    │ False               
+    n_reference     │ 8                   
+  save_checkpoints  │ False               
+════════════════════╧═════════════════════
+[33m        RUN         [0m
+────────────────────┬─────────────────────
+       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      username      │ yanyangji           
+      project       │ diffuser            
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+    script_path     │ None                
+        now         │ 2023-12-06 10:54:13.139864+08:00
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+    job_counter     │ 1                   
+       resume       │ True                
+       readme       │ None                
+       debug        │ False               
+CUDA_VISIBLE_DEVICES│ None                
+     file_stem      │ train               
+════════════════════╧═════════════════════
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       status       │ errored             
+     errorTime      │ 2023-12-06 02:54:17.280334
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+    script_path     │ None                
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      counter       │ 2                   
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        name        │ predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
+       status       │ created             
+     createTime     │ 2023-12-06 03:05:11.350342
+════════════════════╧═════════════════════
+[33m      revision      [0m
+────────────────────┬─────────────────────
+        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+       branch       │ refs/heads/main     
+════════════════════╧═════════════════════
+[33m         fn         [0m
+────────────────────┬─────────────────────
+        name        │ main                
+        doc         │ None                
+       module       │ scripts.train       
+        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+════════════════════╧═════════════════════
+[33m        args        [0m
+────────────────────┬─────────────────────
+()
+════════════════════╧═════════════════════
+[33m       kwargs       [0m
+────────────────────┬─────────────────────
+     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        seed        │ 100                 
+ returns_condition  │ True                
+  predict_epsilon   │ True                
+ n_diffusion_steps  │ 200                 
+ condition_dropout  │ 0.25                
+     diffusion      │ models.GaussianInvDynDiffusion
+   n_train_steps    │ 1000000.0           
+      dataset       │ hopper-medium-expert-v2
+   returns_scale    │ 400.0               
+  RUN.job_counter   │ 1                   
+    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
+════════════════════╧═════════════════════
+taking diff, if this step takes too long, check if your uncommitted changes are too large.
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       job_id       │ None                
+       status       │ started             
+     startTime      │ 2023-12-06 03:05:11.392066
+════════════════════╧═════════════════════
+[33m        host        [0m
+────────────────────┬─────────────────────
+      hostname      │ vll-weiyuan         
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m       Config       [0m
+────────────────────┬─────────────────────
+        seed        │ 100                 
+       device       │ cuda                
+       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+      dataset       │ hopper-medium-expert-v2
+       model        │ models.TemporalUnet 
+     diffusion      │ models.GaussianInvDynDiffusion
+      horizon       │ 100                 
+ n_diffusion_steps  │ 200                 
+   action_weight    │ 10                  
+    loss_weights    │ None                
+   loss_discount    │ 1                   
+  predict_epsilon   │ True                
+     dim_mults      │ (1, 4, 8)           
+ returns_condition  │ True                
+    calc_energy     │ False               
+        dim         │ 128                 
+ condition_dropout  │ 0.25                
+condition_guidance_w│ 1.2                 
+      test_ret      │ 0.9                 
+      renderer      │ utils.MuJoCoRenderer
+       loader       │ datasets.SequenceDataset
+     normalizer     │ CDFNormalizer       
+   preprocess_fns   │ []                  
+   clip_denoised    │ True                
+    use_padding     │ True                
+  include_returns   │ True                
+      discount      │ 0.99                
+  max_path_length   │ 1000                
+     hidden_dim     │ 256                 
+       ar_inv       │ False               
+   train_only_inv   │ False               
+termination_penalty │ -100                
+   returns_scale    │ 400.0               
+ n_steps_per_epoch  │ 10000               
+     loss_type      │ l2                  
+   n_train_steps    │ 1000000.0           
+     batch_size     │ 32                  
+   learning_rate    │ 0.0002              
+gradient_accumulate_every│ 2                   
+     ema_decay      │ 0.995               
+      log_freq      │ 1000                
+     save_freq      │ 10000               
+    sample_freq     │ 10000               
+      n_saves       │ 5                   
+   save_parallel    │ False               
+    n_reference     │ 8                   
+  save_checkpoints  │ False               
+════════════════════╧═════════════════════
+[33m        RUN         [0m
+────────────────────┬─────────────────────
+       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      username      │ yanyangji           
+      project       │ diffuser            
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+    script_path     │ None                
+        now         │ 2023-12-06 11:05:09.240831+08:00
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
+    job_counter     │ 1                   
+       resume       │ True                
+       readme       │ None                
+       debug        │ False               
+CUDA_VISIBLE_DEVICES│ None                
+     file_stem      │ train               
+════════════════════╧═════════════════════
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       status       │ errored             
+     errorTime      │ 2023-12-06 03:05:13.360753
+════════════════════╧═════════════════════
diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..dcb3bf933270214a935cf84c18a923c6cac403f1 100644
GIT binary patch
delta 631
zcmbV}F-sgl6vvsxs|5833fkmiB@u`B=FPmB*(P3d{e1z+-tHY<L=iMWOk+eyk#dzQ
zQl+wYg)LGCL2Sf6<jPb+K0#(zQ7kNy_Rr(@e((P-zD)l9HF<C(&ZCPT<@WbzD5f|z
zE;dSf)`&hIAI~o_x>RdB$Pxt(lT;6q1Xy{mw6$4J;UM*FDJ`$hqQ&Tu;7K_y+E=TM
z8Eyg8V31xRLHVj95;2W71`~so=$N%G#LYWV&8pZyOe8&`_9NVh7M9W;K#G(lY>gXu
z>^X&)DcfhOZR&LJ?Sn=xnwKx5Ck#X0=H1b9ack!qO>SW@33Qa!I;WxNeqIwHzF%r&
zU>QZV%YCe4G*US<2z4R<<5DxKLa^+fMD51(ok)mDB6(M~I^wOEzw-#G4GV!tAHUy`
z2NNgz`Iv6Sn|%CYd1hm{o38h_RyK!w{cPn!aQX?ADOF`6N-{uN{k!QChF8Fxx369c
p&hhZHSe087p;pBDV_qr^jz*upijU7(wf}sZeXt@)4AxL}&R@yxs=NRI

delta 13
UcmaF)fctnicS8%~7N+Az0WYEkc>n+a

diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
index 9a48946..f8c6a65 100644
--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
@@ -1019,3 +1019,59 @@ Traceback (most recent call last):
   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
 AttributeError: 'tuple' object has no attribute 'float'
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+    loss, infos = self.model.loss(*batch)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+    loss, infos = self.model.loss(*batch)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+    return self.dispatch_line(frame)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+    if self.quitting: raise BdbQuit
+bdb.BdbQuit
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
diff --git a/analysis/outputs.log b/analysis/outputs.log
index b36abbc..237e407 100644
--- a/analysis/outputs.log
+++ b/analysis/outputs.log
@@ -65,3 +65,8 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
 diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
 diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
 diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
diff --git a/config/locomotion_config.py b/config/locomotion_config.py
index 7c6d244..314d783 100644
--- a/config/locomotion_config.py
+++ b/config/locomotion_config.py
@@ -6,7 +6,7 @@ class Config(ParamsProto):
     # misc
     seed = 100
     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
 
     ## model
diff --git a/diffuser/datasets/sequence.py b/diffuser/datasets/sequence.py
index 7aa43ce..315a7fd 100644
--- a/diffuser/datasets/sequence.py
+++ b/diffuser/datasets/sequence.py
@@ -15,7 +15,7 @@ ValueBatch = namedtuple('ValueBatch', 'trajectories conditions values')
         
 class SequenceDataset(torch.utils.data.Dataset):
 
-    def __init__(self, env='hopper-medium-replay', horizon=64,
+    def __init__(self, env='kitchen-mixed-v0', horizon=64,
         normalizer='LimitsNormalizer', preprocess_fns=[], max_path_length=1000,
         max_n_episodes=10000, termination_penalty=0, use_padding=True, discount=0.99, returns_scale=1000, include_returns=False):
         self.preprocess_fn = get_preprocess_fn(preprocess_fns, env)
diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
index 43dfdbf..adc2a19 100644
--- a/diffuser/models/diffusion.py
+++ b/diffuser/models/diffusion.py
@@ -3,6 +3,7 @@ import torch
 from torch import nn
 import torch.nn.functional as F
 import pdb
+import clip
 from config.locomotion_config import Config
 
 import diffuser.utils as utils
@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
         self.model = model
         self.ar_inv = ar_inv
         self.train_only_inv = train_only_inv
+        self.device = Config.device
 
         # Text embedding
-        device = Config.device
-        self.proj_layer = nn.Linear(512, self.observation_dim)
+        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
+        self.text_encoder.float()
 
         if self.ar_inv:
             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
index 0b6e0bf..a4200ea 100644
--- a/diffuser/utils/training.py
+++ b/diffuser/utils/training.py
@@ -113,7 +113,7 @@ class Trainer(object):
             for i in range(self.gradient_accumulate_every):
                 batch = next(self.dataloader)
                 batch = batch_to_device(batch, device=self.device)
-                # breakpoint()
+                breakpoint()
                 loss, infos = self.model.loss(*batch)
                 loss = loss / self.gradient_accumulate_every
                 loss.backward()diff --git a/analysis/default_inv.jsonl b/analysis/default_inv.jsonl
index 93fd1aa..53fa0e5 100644
--- a/analysis/default_inv.jsonl
+++ b/analysis/default_inv.jsonl
@@ -1 +1 @@
-{"RUN.prefix": "diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100", "seed": 100, "returns_condition": true, "predict_epsilon": true, "n_diffusion_steps": 200, "condition_dropout": 0.25, "diffusion": "models.GaussianInvDynDiffusion", "n_train_steps": 1000000.0, "dataset": "hopper-medium-expert-v2", "returns_scale": 400.0, "RUN.job_counter": 1, "RUN.job_name": "predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100"}
+{"RUN.prefix": "diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100", "seed": 100, "returns_condition": true, "predict_epsilon": true, "n_diffusion_steps": 200, "condition_dropout": 0.25, "diffusion": "models.GaussianInvDynDiffusion", "n_train_steps": 1000000.0, "dataset": "kitchen-mixed-v0", "returns_scale": 400.0, "RUN.job_counter": 1, "RUN.job_name": "predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100"}
diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
index 5ff999f..166c490 100644
--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
@@ -11634,4 +11634,3503 @@ index db05e5a..53b8e2f 100644
 +            transition_dim=observation_dim,
              cond_dim=observation_dim,
              dim_mults=Config.dim_mults,
-             returns_condition=Config.returns_condition,
\ No newline at end of file
+             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+index 0136a00..53904ea 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+ │        loss        │       0.020        │
+ ╘════════════════════╧════════════════════╛
+ 
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-05 16:58:52.964119
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
+GIT binary patch
+delta 84
+zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
+oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
+
+delta 13
+UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
+
+diff --git a/analysis/outputs.log b/analysis/outputs.log
+index b36abbc..d41a0b9 100644
+--- a/analysis/outputs.log
++++ b/analysis/outputs.log
+@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+index 0b6e0bf..a4200ea 100644
+--- a/diffuser/utils/training.py
++++ b/diffuser/utils/training.py
+@@ -113,7 +113,7 @@ class Trainer(object):
+             for i in range(self.gradient_accumulate_every):
+                 batch = next(self.dataloader)
+                 batch = batch_to_device(batch, device=self.device)
+-                # breakpoint()
++                breakpoint()
+                 loss, infos = self.model.loss(*batch)
+                 loss = loss / self.gradient_accumulate_every
+                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+index 5ff999f..38f3578 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+@@ -11634,4 +11634,86 @@ index db05e5a..53b8e2f 100644
+ +            transition_dim=observation_dim,
+              cond_dim=observation_dim,
+              dim_mults=Config.dim_mults,
+-             returns_condition=Config.returns_condition,
+\ No newline at end of file
++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..53904ea 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
++GIT binary patch
++delta 84
++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
++
++delta 13
++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
++
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..d41a0b9 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()
+\ No newline at end of file
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
+index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..6f13a7941ab36998ac949d345b5116109a90f9c7 100644
+GIT binary patch
+delta 13
+UcmZ21zCwJ%Vs6$3mf9(L03wzIpa1{>
+
+delta 7
+OcmZ1>zF2(2Vr~Eo6$01*
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+index 0136a00..6943886 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+@@ -10016,3 +10016,191 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+ │        loss        │       0.020        │
+ ╘════════════════════╧════════════════════╛
+ 
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-05 16:58:52.964119
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-05 16:58:52.993286
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 00:58:50.921304+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Testing forward... ✓
++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-05 17:05:07.186644
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-06 02:50:33.911493
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0155f5d4aa158f490a1eb2ecebfe3c179f54a7f1 100644
+GIT binary patch
+delta 217
+zcmYMuu}T9$5P)HJ!7327)GAt~I%Z~PXLh#I#`oCU%YjycFJNJpGJ=m_p9@@JEdj9+
+zeF2{&Q5*Z8kAJ(I?4Bq04{qbPujB2Dzjjl}G37{&2_xF-`|)Hhm@2dOT_H$VD)*&;
+zkQuRR*An*CL_-}v*8bf83l=EJaQS|5a3nK;KNuP#3^1Nux#A8{GsFzqU=m>-+~<w^
+uZ7D~{AvA`__Jnu-bY5G4ilHl_G4+ORBE*h#A<9}4|NJh1QHJBUFSiG@F*_~*
+
+delta 13
+Ucmeyrocnk;cS8%~7N+Az0WK5<RsaA1
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+index 9a48946..0b164e7 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+@@ -1019,3 +1019,17 @@ Traceback (most recent call last):
+   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
+     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
+ AttributeError: 'tuple' object has no attribute 'float'
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
+diff --git a/analysis/outputs.log b/analysis/outputs.log
+index b36abbc..8658a70 100644
+--- a/analysis/outputs.log
++++ b/analysis/outputs.log
+@@ -65,3 +65,5 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diff --git a/config/locomotion_config.py b/config/locomotion_config.py
+index 7c6d244..314d783 100644
+--- a/config/locomotion_config.py
++++ b/config/locomotion_config.py
+@@ -6,7 +6,7 @@ class Config(ParamsProto):
+     # misc
+     seed = 100
+     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
+-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
+ 
+     ## model
+diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
+index 43dfdbf..adc2a19 100644
+--- a/diffuser/models/diffusion.py
++++ b/diffuser/models/diffusion.py
+@@ -3,6 +3,7 @@ import torch
+ from torch import nn
+ import torch.nn.functional as F
+ import pdb
++import clip
+ from config.locomotion_config import Config
+ 
+ import diffuser.utils as utils
+@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
+         self.model = model
+         self.ar_inv = ar_inv
+         self.train_only_inv = train_only_inv
++        self.device = Config.device
+ 
+         # Text embedding
+-        device = Config.device
+-        self.proj_layer = nn.Linear(512, self.observation_dim)
++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
++        self.text_encoder.float()
+ 
+         if self.ar_inv:
+             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
+diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+index 0b6e0bf..a4200ea 100644
+--- a/diffuser/utils/training.py
++++ b/diffuser/utils/training.py
+@@ -113,7 +113,7 @@ class Trainer(object):
+             for i in range(self.gradient_accumulate_every):
+                 batch = next(self.dataloader)
+                 batch = batch_to_device(batch, device=self.device)
+-                # breakpoint()
++                breakpoint()
+                 loss, infos = self.model.loss(*batch)
+                 loss = loss / self.gradient_accumulate_every
+                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+index 5ff999f..40ff74e 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+@@ -11634,4 +11634,480 @@ index db05e5a..53b8e2f 100644
+ +            transition_dim=observation_dim,
+              cond_dim=observation_dim,
+              dim_mults=Config.dim_mults,
+-             returns_condition=Config.returns_condition,
+\ No newline at end of file
++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..53904ea 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
++GIT binary patch
++delta 84
++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
++
++delta 13
++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
++
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..d41a0b9 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++index 5ff999f..38f3578 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++@@ -11634,4 +11634,86 @@ index db05e5a..53b8e2f 100644
++ +            transition_dim=observation_dim,
++              cond_dim=observation_dim,
++              dim_mults=Config.dim_mults,
++-             returns_condition=Config.returns_condition,
++\ No newline at end of file
+++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++index 0136a00..53904ea 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+++ │        loss        │       0.020        │
+++ ╘════════════════════╧════════════════════╛
+++ 
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++    script_path     │ None                
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      counter       │ 2                   
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++       status       │ created             
++++     createTime     │ 2023-12-05 16:58:52.964119
++++════════════════════╧═════════════════════
++++[33m      revision      [0m
++++────────────────────┬─────────────────────
++++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++++       branch       │ refs/heads/main     
++++════════════════════╧═════════════════════
++++[33m         fn         [0m
++++────────────────────┬─────────────────────
++++        name        │ main                
++++        doc         │ None                
++++       module       │ scripts.train       
++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++++════════════════════╧═════════════════════
++++[33m        args        [0m
++++────────────────────┬─────────────────────
++++()
++++════════════════════╧═════════════════════
++++[33m       kwargs       [0m
++++────────────────────┬─────────────────────
++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        seed        │ 100                 
++++ returns_condition  │ True                
++++  predict_epsilon   │ True                
++++ n_diffusion_steps  │ 200                 
++++ condition_dropout  │ 0.25                
++++     diffusion      │ models.GaussianInvDynDiffusion
++++   n_train_steps    │ 1000000.0           
++++      dataset       │ hopper-medium-expert-v2
++++   returns_scale    │ 400.0               
++++  RUN.job_counter   │ 1                   
++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++════════════════════╧═════════════════════
++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
+++GIT binary patch
+++delta 84
+++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
+++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
+++
+++delta 13
+++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
+++
+++diff --git a/analysis/outputs.log b/analysis/outputs.log
+++index b36abbc..d41a0b9 100644
+++--- a/analysis/outputs.log
++++++ b/analysis/outputs.log
+++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+++index 0b6e0bf..a4200ea 100644
+++--- a/diffuser/utils/training.py
++++++ b/diffuser/utils/training.py
+++@@ -113,7 +113,7 @@ class Trainer(object):
+++             for i in range(self.gradient_accumulate_every):
+++                 batch = next(self.dataloader)
+++                 batch = batch_to_device(batch, device=self.device)
+++-                # breakpoint()
++++                breakpoint()
+++                 loss, infos = self.model.loss(*batch)
+++                 loss = loss / self.gradient_accumulate_every
+++                 loss.backward()
++\ No newline at end of file
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
++index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..6f13a7941ab36998ac949d345b5116109a90f9c7 100644
++GIT binary patch
++delta 13
++UcmZ21zCwJ%Vs6$3mf9(L03wzIpa1{>
++
++delta 7
++OcmZ1>zF2(2Vr~Eo6$01*
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..6943886 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,191 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       job_id       │ None                
+++       status       │ started             
+++     startTime      │ 2023-12-05 16:58:52.993286
+++════════════════════╧═════════════════════
+++[33m        host        [0m
+++────────────────────┬─────────────────────
+++      hostname      │ vll-weiyuan         
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m       Config       [0m
+++────────────────────┬─────────────────────
+++        seed        │ 100                 
+++       device       │ cuda                
+++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+++      dataset       │ hopper-medium-expert-v2
+++       model        │ models.TemporalUnet 
+++     diffusion      │ models.GaussianInvDynDiffusion
+++      horizon       │ 100                 
+++ n_diffusion_steps  │ 200                 
+++   action_weight    │ 10                  
+++    loss_weights    │ None                
+++   loss_discount    │ 1                   
+++  predict_epsilon   │ True                
+++     dim_mults      │ (1, 4, 8)           
+++ returns_condition  │ True                
+++    calc_energy     │ False               
+++        dim         │ 128                 
+++ condition_dropout  │ 0.25                
+++condition_guidance_w│ 1.2                 
+++      test_ret      │ 0.9                 
+++      renderer      │ utils.MuJoCoRenderer
+++       loader       │ datasets.SequenceDataset
+++     normalizer     │ CDFNormalizer       
+++   preprocess_fns   │ []                  
+++   clip_denoised    │ True                
+++    use_padding     │ True                
+++  include_returns   │ True                
+++      discount      │ 0.99                
+++  max_path_length   │ 1000                
+++     hidden_dim     │ 256                 
+++       ar_inv       │ False               
+++   train_only_inv   │ False               
+++termination_penalty │ -100                
+++   returns_scale    │ 400.0               
+++ n_steps_per_epoch  │ 10000               
+++     loss_type      │ l2                  
+++   n_train_steps    │ 1000000.0           
+++     batch_size     │ 32                  
+++   learning_rate    │ 0.0002              
+++gradient_accumulate_every│ 2                   
+++     ema_decay      │ 0.995               
+++      log_freq      │ 1000                
+++     save_freq      │ 10000               
+++    sample_freq     │ 10000               
+++      n_saves       │ 5                   
+++   save_parallel    │ False               
+++    n_reference     │ 8                   
+++  save_checkpoints  │ False               
+++════════════════════╧═════════════════════
+++[33m        RUN         [0m
+++────────────────────┬─────────────────────
+++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      username      │ yanyangji           
+++      project       │ diffuser            
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++    script_path     │ None                
+++        now         │ 2023-12-06 00:58:50.921304+08:00
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++    job_counter     │ 1                   
+++       resume       │ True                
+++       readme       │ None                
+++       debug        │ False               
+++CUDA_VISIBLE_DEVICES│ None                
+++     file_stem      │ train               
+++════════════════════╧═════════════════════
+++Testing forward... ✓
+++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
+++
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       status       │ errored             
+++     errorTime      │ 2023-12-05 17:05:07.186644
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-06 02:50:33.911493
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0155f5d4aa158f490a1eb2ecebfe3c179f54a7f1 100644
++GIT binary patch
++delta 217
++zcmYMuu}T9$5P)HJ!7327)GAt~I%Z~PXLh#I#`oCU%YjycFJNJpGJ=m_p9@@JEdj9+
++zeF2{&Q5*Z8kAJ(I?4Bq04{qbPujB2Dzjjl}G37{&2_xF-`|)Hhm@2dOT_H$VD)*&;
++zkQuRR*An*CL_-}v*8bf83l=EJaQS|5a3nK;KNuP#3^1Nux#A8{GsFzqU=m>-+~<w^
++uZ7D~{AvA`__Jnu-bY5G4ilHl_G4+ORBE*h#A<9}4|NJh1QHJBUFSiG@F*_~*
++
++delta 13
++Ucmeyrocnk;cS8%~7N+Az0WK5<RsaA1
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++index 9a48946..0b164e7 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++@@ -1019,3 +1019,17 @@ Traceback (most recent call last):
++   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
++     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
++ AttributeError: 'tuple' object has no attribute 'float'
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..8658a70 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,5 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/config/locomotion_config.py b/config/locomotion_config.py
++index 7c6d244..314d783 100644
++--- a/config/locomotion_config.py
+++++ b/config/locomotion_config.py
++@@ -6,7 +6,7 @@ class Config(ParamsProto):
++     # misc
++     seed = 100
++     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
++-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
++ 
++     ## model
++diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
++index 43dfdbf..adc2a19 100644
++--- a/diffuser/models/diffusion.py
+++++ b/diffuser/models/diffusion.py
++@@ -3,6 +3,7 @@ import torch
++ from torch import nn
++ import torch.nn.functional as F
++ import pdb
+++import clip
++ from config.locomotion_config import Config
++ 
++ import diffuser.utils as utils
++@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
++         self.model = model
++         self.ar_inv = ar_inv
++         self.train_only_inv = train_only_inv
+++        self.device = Config.device
++ 
++         # Text embedding
++-        device = Config.device
++-        self.proj_layer = nn.Linear(512, self.observation_dim)
+++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
+++        self.text_encoder.float()
++ 
++         if self.ar_inv:
++             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()
+\ No newline at end of file
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
+index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..c1d221b35a1e6e7cab20fdd218448b73984a7b8f 100644
+GIT binary patch
+delta 18
+WcmZ21zE*t0Vs5Smmf9(LU;+R?ng(qE
+
+delta 7
+OcmZ20zF2(2Vr~EoI0D@O
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+index 0136a00..93fce68 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+@@ -10016,3 +10016,334 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+ │        loss        │       0.020        │
+ ╘════════════════════╧════════════════════╛
+ 
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-05 16:58:52.964119
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-05 16:58:52.993286
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 00:58:50.921304+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Testing forward... ✓
++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-05 17:05:07.186644
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-06 02:50:33.911493
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-06 02:50:33.953978
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 10:50:31.778840+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-06 02:50:35.849523
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-06 02:54:15.281510
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0a8eca6f0943babca69daf94ba5186278e81a2fa 100644
+GIT binary patch
+delta 357
+zcmb7=u}T9$6h)bVQ~@=OppDTgAPn!#ym@bCDs9r|2ZY_(ENCV80~UgXWrTc$ohxi1
+zmJ$#f(I4;&`~}w~AeOe5%ejZUx*6U*4KJ_MgI+zi=a2eSZE*4-d21pQVqARQ?o1d%
+zCX%`;ECehv)kOhpW3(hvl@{w9SzK=4?)8EGB}8WfH^;9>gDoBd^k6X2qJwsSstUD<
+zlE5brgMpc-QSWE!r)!gk<eZ6!6qk6RcPF_7$mptq#fLg#87yLDWzIs919iT0AmnEB
+zvZwzryo<7!Ef1S7*&d8|jGakGM<WsfK{LBPQC++q^`>Ka>w1@UObNZQ0X;&0$Uj^@
+F)Hlu|UN8Uv
+
+delta 13
+UcmZ3zm-~1(cS8%~7N+Az0V>!A7ytkO
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+index 9a48946..4a0b118 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+@@ -1019,3 +1019,31 @@ Traceback (most recent call last):
+   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
+     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
+ AttributeError: 'tuple' object has no attribute 'float'
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+diff --git a/analysis/outputs.log b/analysis/outputs.log
+index b36abbc..6c7de88 100644
+--- a/analysis/outputs.log
++++ b/analysis/outputs.log
+@@ -65,3 +65,6 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diff --git a/config/locomotion_config.py b/config/locomotion_config.py
+index 7c6d244..314d783 100644
+--- a/config/locomotion_config.py
++++ b/config/locomotion_config.py
+@@ -6,7 +6,7 @@ class Config(ParamsProto):
+     # misc
+     seed = 100
+     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
+-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
+ 
+     ## model
+diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
+index 43dfdbf..adc2a19 100644
+--- a/diffuser/models/diffusion.py
++++ b/diffuser/models/diffusion.py
+@@ -3,6 +3,7 @@ import torch
+ from torch import nn
+ import torch.nn.functional as F
+ import pdb
++import clip
+ from config.locomotion_config import Config
+ 
+ import diffuser.utils as utils
+@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
+         self.model = model
+         self.ar_inv = ar_inv
+         self.train_only_inv = train_only_inv
++        self.device = Config.device
+ 
+         # Text embedding
+-        device = Config.device
+-        self.proj_layer = nn.Linear(512, self.observation_dim)
++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
++        self.text_encoder.float()
+ 
+         if self.ar_inv:
+             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
+diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+index 0b6e0bf..a4200ea 100644
+--- a/diffuser/utils/training.py
++++ b/diffuser/utils/training.py
+@@ -113,7 +113,7 @@ class Trainer(object):
+             for i in range(self.gradient_accumulate_every):
+                 batch = next(self.dataloader)
+                 batch = batch_to_device(batch, device=self.device)
+-                # breakpoint()
++                breakpoint()
+                 loss, infos = self.model.loss(*batch)
+                 loss = loss / self.gradient_accumulate_every
+                 loss.backward()diff --git a/analysis/default_inv.jsonl b/analysis/default_inv.jsonl
+index 93fd1aa..9d2b695 100644
+--- a/analysis/default_inv.jsonl
++++ b/analysis/default_inv.jsonl
+@@ -1 +1 @@
+-{"RUN.prefix": "diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100", "seed": 100, "returns_condition": true, "predict_epsilon": true, "n_diffusion_steps": 200, "condition_dropout": 0.25, "diffusion": "models.GaussianInvDynDiffusion", "n_train_steps": 1000000.0, "dataset": "hopper-medium-expert-v2", "returns_scale": 400.0, "RUN.job_counter": 1, "RUN.job_name": "predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100"}
++{"RUN.prefix": "diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100", "seed": 100, "returns_condition": true, "predict_epsilon": true, "n_diffusion_steps": 200, "condition_dropout": 0.25, "diffusion": "models.GaussianInvDynDiffusion", "n_train_steps": 1000000.0, "dataset": "hopper-medium-expert-v2", "returns_scale": 400.0, "RUN.job_counter": 1, "RUN.job_name": "predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100"}
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+index 5ff999f..e3fedbc 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+@@ -11634,4 +11634,1428 @@ index db05e5a..53b8e2f 100644
+ +            transition_dim=observation_dim,
+              cond_dim=observation_dim,
+              dim_mults=Config.dim_mults,
+-             returns_condition=Config.returns_condition,
+\ No newline at end of file
++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..53904ea 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
++GIT binary patch
++delta 84
++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
++
++delta 13
++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
++
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..d41a0b9 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++index 5ff999f..38f3578 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++@@ -11634,4 +11634,86 @@ index db05e5a..53b8e2f 100644
++ +            transition_dim=observation_dim,
++              cond_dim=observation_dim,
++              dim_mults=Config.dim_mults,
++-             returns_condition=Config.returns_condition,
++\ No newline at end of file
+++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++index 0136a00..53904ea 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+++ │        loss        │       0.020        │
+++ ╘════════════════════╧════════════════════╛
+++ 
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++    script_path     │ None                
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      counter       │ 2                   
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++       status       │ created             
++++     createTime     │ 2023-12-05 16:58:52.964119
++++════════════════════╧═════════════════════
++++[33m      revision      [0m
++++────────────────────┬─────────────────────
++++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++++       branch       │ refs/heads/main     
++++════════════════════╧═════════════════════
++++[33m         fn         [0m
++++────────────────────┬─────────────────────
++++        name        │ main                
++++        doc         │ None                
++++       module       │ scripts.train       
++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++++════════════════════╧═════════════════════
++++[33m        args        [0m
++++────────────────────┬─────────────────────
++++()
++++════════════════════╧═════════════════════
++++[33m       kwargs       [0m
++++────────────────────┬─────────────────────
++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        seed        │ 100                 
++++ returns_condition  │ True                
++++  predict_epsilon   │ True                
++++ n_diffusion_steps  │ 200                 
++++ condition_dropout  │ 0.25                
++++     diffusion      │ models.GaussianInvDynDiffusion
++++   n_train_steps    │ 1000000.0           
++++      dataset       │ hopper-medium-expert-v2
++++   returns_scale    │ 400.0               
++++  RUN.job_counter   │ 1                   
++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++════════════════════╧═════════════════════
++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
+++GIT binary patch
+++delta 84
+++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
+++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
+++
+++delta 13
+++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
+++
+++diff --git a/analysis/outputs.log b/analysis/outputs.log
+++index b36abbc..d41a0b9 100644
+++--- a/analysis/outputs.log
++++++ b/analysis/outputs.log
+++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+++index 0b6e0bf..a4200ea 100644
+++--- a/diffuser/utils/training.py
++++++ b/diffuser/utils/training.py
+++@@ -113,7 +113,7 @@ class Trainer(object):
+++             for i in range(self.gradient_accumulate_every):
+++                 batch = next(self.dataloader)
+++                 batch = batch_to_device(batch, device=self.device)
+++-                # breakpoint()
++++                breakpoint()
+++                 loss, infos = self.model.loss(*batch)
+++                 loss = loss / self.gradient_accumulate_every
+++                 loss.backward()
++\ No newline at end of file
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
++index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..6f13a7941ab36998ac949d345b5116109a90f9c7 100644
++GIT binary patch
++delta 13
++UcmZ21zCwJ%Vs6$3mf9(L03wzIpa1{>
++
++delta 7
++OcmZ1>zF2(2Vr~Eo6$01*
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..6943886 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,191 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       job_id       │ None                
+++       status       │ started             
+++     startTime      │ 2023-12-05 16:58:52.993286
+++════════════════════╧═════════════════════
+++[33m        host        [0m
+++────────────────────┬─────────────────────
+++      hostname      │ vll-weiyuan         
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m       Config       [0m
+++────────────────────┬─────────────────────
+++        seed        │ 100                 
+++       device       │ cuda                
+++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+++      dataset       │ hopper-medium-expert-v2
+++       model        │ models.TemporalUnet 
+++     diffusion      │ models.GaussianInvDynDiffusion
+++      horizon       │ 100                 
+++ n_diffusion_steps  │ 200                 
+++   action_weight    │ 10                  
+++    loss_weights    │ None                
+++   loss_discount    │ 1                   
+++  predict_epsilon   │ True                
+++     dim_mults      │ (1, 4, 8)           
+++ returns_condition  │ True                
+++    calc_energy     │ False               
+++        dim         │ 128                 
+++ condition_dropout  │ 0.25                
+++condition_guidance_w│ 1.2                 
+++      test_ret      │ 0.9                 
+++      renderer      │ utils.MuJoCoRenderer
+++       loader       │ datasets.SequenceDataset
+++     normalizer     │ CDFNormalizer       
+++   preprocess_fns   │ []                  
+++   clip_denoised    │ True                
+++    use_padding     │ True                
+++  include_returns   │ True                
+++      discount      │ 0.99                
+++  max_path_length   │ 1000                
+++     hidden_dim     │ 256                 
+++       ar_inv       │ False               
+++   train_only_inv   │ False               
+++termination_penalty │ -100                
+++   returns_scale    │ 400.0               
+++ n_steps_per_epoch  │ 10000               
+++     loss_type      │ l2                  
+++   n_train_steps    │ 1000000.0           
+++     batch_size     │ 32                  
+++   learning_rate    │ 0.0002              
+++gradient_accumulate_every│ 2                   
+++     ema_decay      │ 0.995               
+++      log_freq      │ 1000                
+++     save_freq      │ 10000               
+++    sample_freq     │ 10000               
+++      n_saves       │ 5                   
+++   save_parallel    │ False               
+++    n_reference     │ 8                   
+++  save_checkpoints  │ False               
+++════════════════════╧═════════════════════
+++[33m        RUN         [0m
+++────────────────────┬─────────────────────
+++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      username      │ yanyangji           
+++      project       │ diffuser            
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++    script_path     │ None                
+++        now         │ 2023-12-06 00:58:50.921304+08:00
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++    job_counter     │ 1                   
+++       resume       │ True                
+++       readme       │ None                
+++       debug        │ False               
+++CUDA_VISIBLE_DEVICES│ None                
+++     file_stem      │ train               
+++════════════════════╧═════════════════════
+++Testing forward... ✓
+++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
+++
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       status       │ errored             
+++     errorTime      │ 2023-12-05 17:05:07.186644
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-06 02:50:33.911493
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0155f5d4aa158f490a1eb2ecebfe3c179f54a7f1 100644
++GIT binary patch
++delta 217
++zcmYMuu}T9$5P)HJ!7327)GAt~I%Z~PXLh#I#`oCU%YjycFJNJpGJ=m_p9@@JEdj9+
++zeF2{&Q5*Z8kAJ(I?4Bq04{qbPujB2Dzjjl}G37{&2_xF-`|)Hhm@2dOT_H$VD)*&;
++zkQuRR*An*CL_-}v*8bf83l=EJaQS|5a3nK;KNuP#3^1Nux#A8{GsFzqU=m>-+~<w^
++uZ7D~{AvA`__Jnu-bY5G4ilHl_G4+ORBE*h#A<9}4|NJh1QHJBUFSiG@F*_~*
++
++delta 13
++Ucmeyrocnk;cS8%~7N+Az0WK5<RsaA1
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++index 9a48946..0b164e7 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++@@ -1019,3 +1019,17 @@ Traceback (most recent call last):
++   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
++     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
++ AttributeError: 'tuple' object has no attribute 'float'
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..8658a70 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,5 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/config/locomotion_config.py b/config/locomotion_config.py
++index 7c6d244..314d783 100644
++--- a/config/locomotion_config.py
+++++ b/config/locomotion_config.py
++@@ -6,7 +6,7 @@ class Config(ParamsProto):
++     # misc
++     seed = 100
++     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
++-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
++ 
++     ## model
++diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
++index 43dfdbf..adc2a19 100644
++--- a/diffuser/models/diffusion.py
+++++ b/diffuser/models/diffusion.py
++@@ -3,6 +3,7 @@ import torch
++ from torch import nn
++ import torch.nn.functional as F
++ import pdb
+++import clip
++ from config.locomotion_config import Config
++ 
++ import diffuser.utils as utils
++@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
++         self.model = model
++         self.ar_inv = ar_inv
++         self.train_only_inv = train_only_inv
+++        self.device = Config.device
++ 
++         # Text embedding
++-        device = Config.device
++-        self.proj_layer = nn.Linear(512, self.observation_dim)
+++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
+++        self.text_encoder.float()
++ 
++         if self.ar_inv:
++             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++index 5ff999f..40ff74e 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++@@ -11634,4 +11634,480 @@ index db05e5a..53b8e2f 100644
++ +            transition_dim=observation_dim,
++              cond_dim=observation_dim,
++              dim_mults=Config.dim_mults,
++-             returns_condition=Config.returns_condition,
++\ No newline at end of file
+++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++index 0136a00..53904ea 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+++ │        loss        │       0.020        │
+++ ╘════════════════════╧════════════════════╛
+++ 
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++    script_path     │ None                
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      counter       │ 2                   
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++       status       │ created             
++++     createTime     │ 2023-12-05 16:58:52.964119
++++════════════════════╧═════════════════════
++++[33m      revision      [0m
++++────────────────────┬─────────────────────
++++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++++       branch       │ refs/heads/main     
++++════════════════════╧═════════════════════
++++[33m         fn         [0m
++++────────────────────┬─────────────────────
++++        name        │ main                
++++        doc         │ None                
++++       module       │ scripts.train       
++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++++════════════════════╧═════════════════════
++++[33m        args        [0m
++++────────────────────┬─────────────────────
++++()
++++════════════════════╧═════════════════════
++++[33m       kwargs       [0m
++++────────────────────┬─────────────────────
++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        seed        │ 100                 
++++ returns_condition  │ True                
++++  predict_epsilon   │ True                
++++ n_diffusion_steps  │ 200                 
++++ condition_dropout  │ 0.25                
++++     diffusion      │ models.GaussianInvDynDiffusion
++++   n_train_steps    │ 1000000.0           
++++      dataset       │ hopper-medium-expert-v2
++++   returns_scale    │ 400.0               
++++  RUN.job_counter   │ 1                   
++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++════════════════════╧═════════════════════
++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
+++GIT binary patch
+++delta 84
+++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
+++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
+++
+++delta 13
+++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
+++
+++diff --git a/analysis/outputs.log b/analysis/outputs.log
+++index b36abbc..d41a0b9 100644
+++--- a/analysis/outputs.log
++++++ b/analysis/outputs.log
+++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+++index 0b6e0bf..a4200ea 100644
+++--- a/diffuser/utils/training.py
++++++ b/diffuser/utils/training.py
+++@@ -113,7 +113,7 @@ class Trainer(object):
+++             for i in range(self.gradient_accumulate_every):
+++                 batch = next(self.dataloader)
+++                 batch = batch_to_device(batch, device=self.device)
+++-                # breakpoint()
++++                breakpoint()
+++                 loss, infos = self.model.loss(*batch)
+++                 loss = loss / self.gradient_accumulate_every
+++                 loss.backward()diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++index 5ff999f..38f3578 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/index.diff
+++@@ -11634,4 +11634,86 @@ index db05e5a..53b8e2f 100644
+++ +            transition_dim=observation_dim,
+++              cond_dim=observation_dim,
+++              dim_mults=Config.dim_mults,
+++-             returns_condition=Config.returns_condition,
+++\ No newline at end of file
++++             returns_condition=Config.returns_condition,diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++index 0136a00..53904ea 100644
++++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++@@ -10016,3 +10016,46 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++++ │        loss        │       0.020        │
++++ ╘════════════════════╧════════════════════╛
++++ 
+++++══════════════════════════════════════════
+++++[33m        job         [0m
+++++────────────────────┬─────────────────────
+++++    script_path     │ None                
+++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++++      counter       │ 2                   
+++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++++       status       │ created             
+++++     createTime     │ 2023-12-05 16:58:52.964119
+++++════════════════════╧═════════════════════
+++++[33m      revision      [0m
+++++────────────────────┬─────────────────────
+++++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++++       branch       │ refs/heads/main     
+++++════════════════════╧═════════════════════
+++++[33m         fn         [0m
+++++────────────────────┬─────────────────────
+++++        name        │ main                
+++++        doc         │ None                
+++++       module       │ scripts.train       
+++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++++════════════════════╧═════════════════════
+++++[33m        args        [0m
+++++────────────────────┬─────────────────────
+++++()
+++++════════════════════╧═════════════════════
+++++[33m       kwargs       [0m
+++++────────────────────┬─────────────────────
+++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++++        seed        │ 100                 
+++++ returns_condition  │ True                
+++++  predict_epsilon   │ True                
+++++ n_diffusion_steps  │ 200                 
+++++ condition_dropout  │ 0.25                
+++++     diffusion      │ models.GaussianInvDynDiffusion
+++++   n_train_steps    │ 1000000.0           
+++++      dataset       │ hopper-medium-expert-v2
+++++   returns_scale    │ 400.0               
+++++  RUN.job_counter   │ 1                   
+++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++++════════════════════╧═════════════════════
+++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..36121f815a45b8281a1b9c6183cd9737560b0a6a 100644
++++GIT binary patch
++++delta 84
++++zcmX@!&3$<icS8%~7N+Azw-@YY%4Fm-vof`?GBwh(G&3<Yw4D5Kill~_p+&NZiFsN|
++++oqLG1xVPdjLT4JJsnUSTXk%_r^N|KRbTC$~?xpDGl!BbZl0j|m#$^ZZW
++++
++++delta 13
++++UcmcaSiTijrcS8%~7N+Az0V>=E6#xJL
++++
++++diff --git a/analysis/outputs.log b/analysis/outputs.log
++++index b36abbc..d41a0b9 100644
++++--- a/analysis/outputs.log
+++++++ b/analysis/outputs.log
++++@@ -65,3 +65,4 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++++index 0b6e0bf..a4200ea 100644
++++--- a/diffuser/utils/training.py
+++++++ b/diffuser/utils/training.py
++++@@ -113,7 +113,7 @@ class Trainer(object):
++++             for i in range(self.gradient_accumulate_every):
++++                 batch = next(self.dataloader)
++++                 batch = batch_to_device(batch, device=self.device)
++++-                # breakpoint()
+++++                breakpoint()
++++                 loss, infos = self.model.loss(*batch)
++++                 loss = loss / self.gradient_accumulate_every
++++                 loss.backward()
+++\ No newline at end of file
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
+++index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..6f13a7941ab36998ac949d345b5116109a90f9c7 100644
+++GIT binary patch
+++delta 13
+++UcmZ21zCwJ%Vs6$3mf9(L03wzIpa1{>
+++
+++delta 7
+++OcmZ1>zF2(2Vr~Eo6$01*
+++
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++index 0136a00..6943886 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++@@ -10016,3 +10016,191 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+++ │        loss        │       0.020        │
+++ ╘════════════════════╧════════════════════╛
+++ 
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++    script_path     │ None                
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      counter       │ 2                   
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++       status       │ created             
++++     createTime     │ 2023-12-05 16:58:52.964119
++++════════════════════╧═════════════════════
++++[33m      revision      [0m
++++────────────────────┬─────────────────────
++++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++++       branch       │ refs/heads/main     
++++════════════════════╧═════════════════════
++++[33m         fn         [0m
++++────────────────────┬─────────────────────
++++        name        │ main                
++++        doc         │ None                
++++       module       │ scripts.train       
++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++++════════════════════╧═════════════════════
++++[33m        args        [0m
++++────────────────────┬─────────────────────
++++()
++++════════════════════╧═════════════════════
++++[33m       kwargs       [0m
++++────────────────────┬─────────────────────
++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        seed        │ 100                 
++++ returns_condition  │ True                
++++  predict_epsilon   │ True                
++++ n_diffusion_steps  │ 200                 
++++ condition_dropout  │ 0.25                
++++     diffusion      │ models.GaussianInvDynDiffusion
++++   n_train_steps    │ 1000000.0           
++++      dataset       │ hopper-medium-expert-v2
++++   returns_scale    │ 400.0               
++++  RUN.job_counter   │ 1                   
++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++════════════════════╧═════════════════════
++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++       job_id       │ None                
++++       status       │ started             
++++     startTime      │ 2023-12-05 16:58:52.993286
++++════════════════════╧═════════════════════
++++[33m        host        [0m
++++────────────────────┬─────────────────────
++++      hostname      │ vll-weiyuan         
++++════════════════════╧═════════════════════
++++══════════════════════════════════════════
++++[33m       Config       [0m
++++────────────────────┬─────────────────────
++++        seed        │ 100                 
++++       device       │ cuda                
++++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++++      dataset       │ hopper-medium-expert-v2
++++       model        │ models.TemporalUnet 
++++     diffusion      │ models.GaussianInvDynDiffusion
++++      horizon       │ 100                 
++++ n_diffusion_steps  │ 200                 
++++   action_weight    │ 10                  
++++    loss_weights    │ None                
++++   loss_discount    │ 1                   
++++  predict_epsilon   │ True                
++++     dim_mults      │ (1, 4, 8)           
++++ returns_condition  │ True                
++++    calc_energy     │ False               
++++        dim         │ 128                 
++++ condition_dropout  │ 0.25                
++++condition_guidance_w│ 1.2                 
++++      test_ret      │ 0.9                 
++++      renderer      │ utils.MuJoCoRenderer
++++       loader       │ datasets.SequenceDataset
++++     normalizer     │ CDFNormalizer       
++++   preprocess_fns   │ []                  
++++   clip_denoised    │ True                
++++    use_padding     │ True                
++++  include_returns   │ True                
++++      discount      │ 0.99                
++++  max_path_length   │ 1000                
++++     hidden_dim     │ 256                 
++++       ar_inv       │ False               
++++   train_only_inv   │ False               
++++termination_penalty │ -100                
++++   returns_scale    │ 400.0               
++++ n_steps_per_epoch  │ 10000               
++++     loss_type      │ l2                  
++++   n_train_steps    │ 1000000.0           
++++     batch_size     │ 32                  
++++   learning_rate    │ 0.0002              
++++gradient_accumulate_every│ 2                   
++++     ema_decay      │ 0.995               
++++      log_freq      │ 1000                
++++     save_freq      │ 10000               
++++    sample_freq     │ 10000               
++++      n_saves       │ 5                   
++++   save_parallel    │ False               
++++    n_reference     │ 8                   
++++  save_checkpoints  │ False               
++++════════════════════╧═════════════════════
++++[33m        RUN         [0m
++++────────────────────┬─────────────────────
++++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      username      │ yanyangji           
++++      project       │ diffuser            
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++    script_path     │ None                
++++        now         │ 2023-12-06 00:58:50.921304+08:00
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++    job_counter     │ 1                   
++++       resume       │ True                
++++       readme       │ None                
++++       debug        │ False               
++++CUDA_VISIBLE_DEVICES│ None                
++++     file_stem      │ train               
++++════════════════════╧═════════════════════
++++Testing forward... ✓
++++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++Traceback (most recent call last):
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++++    results = fn(*(args or ARGS), **_KWARGS)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++++    loss, infos = self.model.loss(*batch)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++++    loss, infos = self.model.loss(*batch)
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++++    return self.dispatch_line(frame)
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++++    if self.quitting: raise BdbQuit
++++bdb.BdbQuit
++++
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++       status       │ errored             
++++     errorTime      │ 2023-12-05 17:05:07.186644
++++════════════════════╧═════════════════════
++++══════════════════════════════════════════
++++[33m        job         [0m
++++────────────────────┬─────────────────────
++++    script_path     │ None                
++++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++++      counter       │ 2                   
++++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++       status       │ created             
++++     createTime     │ 2023-12-06 02:50:33.911493
++++════════════════════╧═════════════════════
++++[33m      revision      [0m
++++────────────────────┬─────────────────────
++++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++++       branch       │ refs/heads/main     
++++════════════════════╧═════════════════════
++++[33m         fn         [0m
++++────────────────────┬─────────────────────
++++        name        │ main                
++++        doc         │ None                
++++       module       │ scripts.train       
++++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++++════════════════════╧═════════════════════
++++[33m        args        [0m
++++────────────────────┬─────────────────────
++++()
++++════════════════════╧═════════════════════
++++[33m       kwargs       [0m
++++────────────────────┬─────────────────────
++++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++        seed        │ 100                 
++++ returns_condition  │ True                
++++  predict_epsilon   │ True                
++++ n_diffusion_steps  │ 200                 
++++ condition_dropout  │ 0.25                
++++     diffusion      │ models.GaussianInvDynDiffusion
++++   n_train_steps    │ 1000000.0           
++++      dataset       │ hopper-medium-expert-v2
++++   returns_scale    │ 400.0               
++++  RUN.job_counter   │ 1                   
++++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++════════════════════╧═════════════════════
++++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0155f5d4aa158f490a1eb2ecebfe3c179f54a7f1 100644
+++GIT binary patch
+++delta 217
+++zcmYMuu}T9$5P)HJ!7327)GAt~I%Z~PXLh#I#`oCU%YjycFJNJpGJ=m_p9@@JEdj9+
+++zeF2{&Q5*Z8kAJ(I?4Bq04{qbPujB2Dzjjl}G37{&2_xF-`|)Hhm@2dOT_H$VD)*&;
+++zkQuRR*An*CL_-}v*8bf83l=EJaQS|5a3nK;KNuP#3^1Nux#A8{GsFzqU=m>-+~<w^
+++uZ7D~{AvA`__Jnu-bY5G4ilHl_G4+ORBE*h#A<9}4|NJh1QHJBUFSiG@F*_~*
+++
+++delta 13
+++Ucmeyrocnk;cS8%~7N+Az0WK5<RsaA1
+++
+++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++index 9a48946..0b164e7 100644
+++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++@@ -1019,3 +1019,17 @@ Traceback (most recent call last):
+++   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
+++     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
+++ AttributeError: 'tuple' object has no attribute 'float'
++++Traceback (most recent call last):
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++++    results = fn(*(args or ARGS), **_KWARGS)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++++    loss, infos = self.model.loss(*batch)
++++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++++    loss, infos = self.model.loss(*batch)
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++++    return self.dispatch_line(frame)
++++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++++    if self.quitting: raise BdbQuit
++++bdb.BdbQuit
+++diff --git a/analysis/outputs.log b/analysis/outputs.log
+++index b36abbc..8658a70 100644
+++--- a/analysis/outputs.log
++++++ b/analysis/outputs.log
+++@@ -65,3 +65,5 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diff --git a/config/locomotion_config.py b/config/locomotion_config.py
+++index 7c6d244..314d783 100644
+++--- a/config/locomotion_config.py
++++++ b/config/locomotion_config.py
+++@@ -6,7 +6,7 @@ class Config(ParamsProto):
+++     # misc
+++     seed = 100
+++     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
+++-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+++     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
+++ 
+++     ## model
+++diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
+++index 43dfdbf..adc2a19 100644
+++--- a/diffuser/models/diffusion.py
++++++ b/diffuser/models/diffusion.py
+++@@ -3,6 +3,7 @@ import torch
+++ from torch import nn
+++ import torch.nn.functional as F
+++ import pdb
++++import clip
+++ from config.locomotion_config import Config
+++ 
+++ import diffuser.utils as utils
+++@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
+++         self.model = model
+++         self.ar_inv = ar_inv
+++         self.train_only_inv = train_only_inv
++++        self.device = Config.device
+++ 
+++         # Text embedding
+++-        device = Config.device
+++-        self.proj_layer = nn.Linear(512, self.observation_dim)
++++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
++++        self.text_encoder.float()
+++ 
+++         if self.ar_inv:
+++             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
+++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+++index 0b6e0bf..a4200ea 100644
+++--- a/diffuser/utils/training.py
++++++ b/diffuser/utils/training.py
+++@@ -113,7 +113,7 @@ class Trainer(object):
+++             for i in range(self.gradient_accumulate_every):
+++                 batch = next(self.dataloader)
+++                 batch = batch_to_device(batch, device=self.device)
+++-                # breakpoint()
++++                breakpoint()
+++                 loss, infos = self.model.loss(*batch)
+++                 loss = loss / self.gradient_accumulate_every
+++                 loss.backward()
++\ No newline at end of file
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
++index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..c1d221b35a1e6e7cab20fdd218448b73984a7b8f 100644
++GIT binary patch
++delta 18
++WcmZ21zE*t0Vs5Smmf9(LU;+R?ng(qE
++
++delta 7
++OcmZ20zF2(2Vr~EoI0D@O
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++index 0136a00..93fce68 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++@@ -10016,3 +10016,334 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
++ │        loss        │       0.020        │
++ ╘════════════════════╧════════════════════╛
++ 
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-05 16:58:52.964119
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       job_id       │ None                
+++       status       │ started             
+++     startTime      │ 2023-12-05 16:58:52.993286
+++════════════════════╧═════════════════════
+++[33m        host        [0m
+++────────────────────┬─────────────────────
+++      hostname      │ vll-weiyuan         
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m       Config       [0m
+++────────────────────┬─────────────────────
+++        seed        │ 100                 
+++       device       │ cuda                
+++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+++      dataset       │ hopper-medium-expert-v2
+++       model        │ models.TemporalUnet 
+++     diffusion      │ models.GaussianInvDynDiffusion
+++      horizon       │ 100                 
+++ n_diffusion_steps  │ 200                 
+++   action_weight    │ 10                  
+++    loss_weights    │ None                
+++   loss_discount    │ 1                   
+++  predict_epsilon   │ True                
+++     dim_mults      │ (1, 4, 8)           
+++ returns_condition  │ True                
+++    calc_energy     │ False               
+++        dim         │ 128                 
+++ condition_dropout  │ 0.25                
+++condition_guidance_w│ 1.2                 
+++      test_ret      │ 0.9                 
+++      renderer      │ utils.MuJoCoRenderer
+++       loader       │ datasets.SequenceDataset
+++     normalizer     │ CDFNormalizer       
+++   preprocess_fns   │ []                  
+++   clip_denoised    │ True                
+++    use_padding     │ True                
+++  include_returns   │ True                
+++      discount      │ 0.99                
+++  max_path_length   │ 1000                
+++     hidden_dim     │ 256                 
+++       ar_inv       │ False               
+++   train_only_inv   │ False               
+++termination_penalty │ -100                
+++   returns_scale    │ 400.0               
+++ n_steps_per_epoch  │ 10000               
+++     loss_type      │ l2                  
+++   n_train_steps    │ 1000000.0           
+++     batch_size     │ 32                  
+++   learning_rate    │ 0.0002              
+++gradient_accumulate_every│ 2                   
+++     ema_decay      │ 0.995               
+++      log_freq      │ 1000                
+++     save_freq      │ 10000               
+++    sample_freq     │ 10000               
+++      n_saves       │ 5                   
+++   save_parallel    │ False               
+++    n_reference     │ 8                   
+++  save_checkpoints  │ False               
+++════════════════════╧═════════════════════
+++[33m        RUN         [0m
+++────────────────────┬─────────────────────
+++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      username      │ yanyangji           
+++      project       │ diffuser            
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++    script_path     │ None                
+++        now         │ 2023-12-06 00:58:50.921304+08:00
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++    job_counter     │ 1                   
+++       resume       │ True                
+++       readme       │ None                
+++       debug        │ False               
+++CUDA_VISIBLE_DEVICES│ None                
+++     file_stem      │ train               
+++════════════════════╧═════════════════════
+++Testing forward... ✓
+++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
+++
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       status       │ errored             
+++     errorTime      │ 2023-12-05 17:05:07.186644
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-06 02:50:33.911493
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       job_id       │ None                
+++       status       │ started             
+++     startTime      │ 2023-12-06 02:50:33.953978
+++════════════════════╧═════════════════════
+++[33m        host        [0m
+++────────────────────┬─────────────────────
+++      hostname      │ vll-weiyuan         
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m       Config       [0m
+++────────────────────┬─────────────────────
+++        seed        │ 100                 
+++       device       │ cuda                
+++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+++      dataset       │ hopper-medium-expert-v2
+++       model        │ models.TemporalUnet 
+++     diffusion      │ models.GaussianInvDynDiffusion
+++      horizon       │ 100                 
+++ n_diffusion_steps  │ 200                 
+++   action_weight    │ 10                  
+++    loss_weights    │ None                
+++   loss_discount    │ 1                   
+++  predict_epsilon   │ True                
+++     dim_mults      │ (1, 4, 8)           
+++ returns_condition  │ True                
+++    calc_energy     │ False               
+++        dim         │ 128                 
+++ condition_dropout  │ 0.25                
+++condition_guidance_w│ 1.2                 
+++      test_ret      │ 0.9                 
+++      renderer      │ utils.MuJoCoRenderer
+++       loader       │ datasets.SequenceDataset
+++     normalizer     │ CDFNormalizer       
+++   preprocess_fns   │ []                  
+++   clip_denoised    │ True                
+++    use_padding     │ True                
+++  include_returns   │ True                
+++      discount      │ 0.99                
+++  max_path_length   │ 1000                
+++     hidden_dim     │ 256                 
+++       ar_inv       │ False               
+++   train_only_inv   │ False               
+++termination_penalty │ -100                
+++   returns_scale    │ 400.0               
+++ n_steps_per_epoch  │ 10000               
+++     loss_type      │ l2                  
+++   n_train_steps    │ 1000000.0           
+++     batch_size     │ 32                  
+++   learning_rate    │ 0.0002              
+++gradient_accumulate_every│ 2                   
+++     ema_decay      │ 0.995               
+++      log_freq      │ 1000                
+++     save_freq      │ 10000               
+++    sample_freq     │ 10000               
+++      n_saves       │ 5                   
+++   save_parallel    │ False               
+++    n_reference     │ 8                   
+++  save_checkpoints  │ False               
+++════════════════════╧═════════════════════
+++[33m        RUN         [0m
+++────────────────────┬─────────────────────
+++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      username      │ yanyangji           
+++      project       │ diffuser            
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++    script_path     │ None                
+++        now         │ 2023-12-06 10:50:31.778840+08:00
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++    job_counter     │ 1                   
+++       resume       │ True                
+++       readme       │ None                
+++       debug        │ False               
+++CUDA_VISIBLE_DEVICES│ None                
+++     file_stem      │ train               
+++════════════════════╧═════════════════════
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+++    dataset = dataset_config()
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+++    instance = self._class(*args, **kwargs, **self._dict)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+++    for i, episode in enumerate(itr):
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+++    target_task = list(env.tasks_to_complete)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+++    return getattr(self._wrapped_env, attr)
+++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+++
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++       status       │ errored             
+++     errorTime      │ 2023-12-06 02:50:35.849523
+++════════════════════╧═════════════════════
+++══════════════════════════════════════════
+++[33m        job         [0m
+++────────────────────┬─────────────────────
+++    script_path     │ None                
+++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+++      counter       │ 2                   
+++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++       status       │ created             
+++     createTime     │ 2023-12-06 02:54:15.281510
+++════════════════════╧═════════════════════
+++[33m      revision      [0m
+++────────────────────┬─────────────────────
+++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+++       branch       │ refs/heads/main     
+++════════════════════╧═════════════════════
+++[33m         fn         [0m
+++────────────────────┬─────────────────────
+++        name        │ main                
+++        doc         │ None                
+++       module       │ scripts.train       
+++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+++════════════════════╧═════════════════════
+++[33m        args        [0m
+++────────────────────┬─────────────────────
+++()
+++════════════════════╧═════════════════════
+++[33m       kwargs       [0m
+++────────────────────┬─────────────────────
+++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++        seed        │ 100                 
+++ returns_condition  │ True                
+++  predict_epsilon   │ True                
+++ n_diffusion_steps  │ 200                 
+++ condition_dropout  │ 0.25                
+++     diffusion      │ models.GaussianInvDynDiffusion
+++   n_train_steps    │ 1000000.0           
+++      dataset       │ hopper-medium-expert-v2
+++   returns_scale    │ 400.0               
+++  RUN.job_counter   │ 1                   
+++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++════════════════════╧═════════════════════
+++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
++index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..0a8eca6f0943babca69daf94ba5186278e81a2fa 100644
++GIT binary patch
++delta 357
++zcmb7=u}T9$6h)bVQ~@=OppDTgAPn!#ym@bCDs9r|2ZY_(ENCV80~UgXWrTc$ohxi1
++zmJ$#f(I4;&`~}w~AeOe5%ejZUx*6U*4KJ_MgI+zi=a2eSZE*4-d21pQVqARQ?o1d%
++zCX%`;ECehv)kOhpW3(hvl@{w9SzK=4?)8EGB}8WfH^;9>gDoBd^k6X2qJwsSstUD<
++zlE5brgMpc-QSWE!r)!gk<eZ6!6qk6RcPF_7$mptq#fLg#87yLDWzIs919iT0AmnEB
++zvZwzryo<7!Ef1S7*&d8|jGakGM<WsfK{LBPQC++q^`>Ka>w1@UObNZQ0X;&0$Uj^@
++F)Hlu|UN8Uv
++
++delta 13
++UcmZ3zm-~1(cS8%~7N+Az0V>!A7ytkO
++
++diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++index 9a48946..4a0b118 100644
++--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++@@ -1019,3 +1019,31 @@ Traceback (most recent call last):
++   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
++     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
++ AttributeError: 'tuple' object has no attribute 'float'
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+++    loss, infos = self.model.loss(*batch)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+++    return self.dispatch_line(frame)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+++    if self.quitting: raise BdbQuit
+++bdb.BdbQuit
+++Traceback (most recent call last):
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+++    results = fn(*(args or ARGS), **_KWARGS)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+++    dataset = dataset_config()
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+++    instance = self._class(*args, **kwargs, **self._dict)
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+++    for i, episode in enumerate(itr):
+++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+++    target_task = list(env.tasks_to_complete)
+++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+++    return getattr(self._wrapped_env, attr)
+++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
++diff --git a/analysis/outputs.log b/analysis/outputs.log
++index b36abbc..6c7de88 100644
++--- a/analysis/outputs.log
+++++ b/analysis/outputs.log
++@@ -65,3 +65,6 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diff --git a/config/locomotion_config.py b/config/locomotion_config.py
++index 7c6d244..314d783 100644
++--- a/config/locomotion_config.py
+++++ b/config/locomotion_config.py
++@@ -6,7 +6,7 @@ class Config(ParamsProto):
++     # misc
++     seed = 100
++     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
++-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
++ 
++     ## model
++diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
++index 43dfdbf..adc2a19 100644
++--- a/diffuser/models/diffusion.py
+++++ b/diffuser/models/diffusion.py
++@@ -3,6 +3,7 @@ import torch
++ from torch import nn
++ import torch.nn.functional as F
++ import pdb
+++import clip
++ from config.locomotion_config import Config
++ 
++ import diffuser.utils as utils
++@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
++         self.model = model
++         self.ar_inv = ar_inv
++         self.train_only_inv = train_only_inv
+++        self.device = Config.device
++ 
++         # Text embedding
++-        device = Config.device
++-        self.proj_layer = nn.Linear(512, self.observation_dim)
+++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
+++        self.text_encoder.float()
++ 
++         if self.ar_inv:
++             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
++diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
++index 0b6e0bf..a4200ea 100644
++--- a/diffuser/utils/training.py
+++++ b/diffuser/utils/training.py
++@@ -113,7 +113,7 @@ class Trainer(object):
++             for i in range(self.gradient_accumulate_every):
++                 batch = next(self.dataloader)
++                 batch = batch_to_device(batch, device=self.device)
++-                # breakpoint()
+++                breakpoint()
++                 loss, infos = self.model.loss(*batch)
++                 loss = loss / self.gradient_accumulate_every
++                 loss.backward()
+\ No newline at end of file
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
+index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..dfcc151ff6bd7034ec077a18c06a9c99c74c2262 100644
+GIT binary patch
+delta 11
+ScmZ21zDaz;V(!ULS@{7R*#vF?
+
+delta 7
+OcmdlazF2(2Vr~EoTLR($
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+index 0136a00..43ce3af 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+@@ -10016,3 +10016,477 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
+ │        loss        │       0.020        │
+ ╘════════════════════╧════════════════════╛
+ 
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-05 16:58:52.964119
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-05 16:58:52.993286
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 00:58:50.921304+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Testing forward... ✓
++Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-05 17:05:07.186644
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-06 02:50:33.911493
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-06 02:50:33.953978
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 10:50:31.778840+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-06 02:50:35.849523
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++       status       │ created             
++     createTime     │ 2023-12-06 02:54:15.281510
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       job_id       │ None                
++       status       │ started             
++     startTime      │ 2023-12-06 02:54:15.328619
++════════════════════╧═════════════════════
++[33m        host        [0m
++────────────────────┬─────────────────────
++      hostname      │ vll-weiyuan         
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m       Config       [0m
++────────────────────┬─────────────────────
++        seed        │ 100                 
++       device       │ cuda                
++       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
++      dataset       │ hopper-medium-expert-v2
++       model        │ models.TemporalUnet 
++     diffusion      │ models.GaussianInvDynDiffusion
++      horizon       │ 100                 
++ n_diffusion_steps  │ 200                 
++   action_weight    │ 10                  
++    loss_weights    │ None                
++   loss_discount    │ 1                   
++  predict_epsilon   │ True                
++     dim_mults      │ (1, 4, 8)           
++ returns_condition  │ True                
++    calc_energy     │ False               
++        dim         │ 128                 
++ condition_dropout  │ 0.25                
++condition_guidance_w│ 1.2                 
++      test_ret      │ 0.9                 
++      renderer      │ utils.MuJoCoRenderer
++       loader       │ datasets.SequenceDataset
++     normalizer     │ CDFNormalizer       
++   preprocess_fns   │ []                  
++   clip_denoised    │ True                
++    use_padding     │ True                
++  include_returns   │ True                
++      discount      │ 0.99                
++  max_path_length   │ 1000                
++     hidden_dim     │ 256                 
++       ar_inv       │ False               
++   train_only_inv   │ False               
++termination_penalty │ -100                
++   returns_scale    │ 400.0               
++ n_steps_per_epoch  │ 10000               
++     loss_type      │ l2                  
++   n_train_steps    │ 1000000.0           
++     batch_size     │ 32                  
++   learning_rate    │ 0.0002              
++gradient_accumulate_every│ 2                   
++     ema_decay      │ 0.995               
++      log_freq      │ 1000                
++     save_freq      │ 10000               
++    sample_freq     │ 10000               
++      n_saves       │ 5                   
++   save_parallel    │ False               
++    n_reference     │ 8                   
++  save_checkpoints  │ False               
++════════════════════╧═════════════════════
++[33m        RUN         [0m
++────────────────────┬─────────────────────
++       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      username      │ yanyangji           
++      project       │ diffuser            
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++    script_path     │ None                
++        now         │ 2023-12-06 10:54:13.139864+08:00
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++    job_counter     │ 1                   
++       resume       │ True                
++       readme       │ None                
++       debug        │ False               
++CUDA_VISIBLE_DEVICES│ None                
++     file_stem      │ train               
++════════════════════╧═════════════════════
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
++
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++       status       │ errored             
++     errorTime      │ 2023-12-06 02:54:17.280334
++════════════════════╧═════════════════════
++══════════════════════════════════════════
++[33m        job         [0m
++────────────────────┬─────────────────────
++    script_path     │ None                
++    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
++      counter       │ 2                   
++       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        name        │ predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
++       status       │ created             
++     createTime     │ 2023-12-06 03:05:11.350342
++════════════════════╧═════════════════════
++[33m      revision      [0m
++────────────────────┬─────────────────────
++        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
++       branch       │ refs/heads/main     
++════════════════════╧═════════════════════
++[33m         fn         [0m
++────────────────────┬─────────────────────
++        name        │ main                
++        doc         │ None                
++       module       │ scripts.train       
++        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
++════════════════════╧═════════════════════
++[33m        args        [0m
++────────────────────┬─────────────────────
++()
++════════════════════╧═════════════════════
++[33m       kwargs       [0m
++────────────────────┬─────────────────────
++     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++        seed        │ 100                 
++ returns_condition  │ True                
++  predict_epsilon   │ True                
++ n_diffusion_steps  │ 200                 
++ condition_dropout  │ 0.25                
++     diffusion      │ models.GaussianInvDynDiffusion
++   n_train_steps    │ 1000000.0           
++      dataset       │ hopper-medium-expert-v2
++   returns_scale    │ 400.0               
++  RUN.job_counter   │ 1                   
++    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
++════════════════════╧═════════════════════
++taking diff, if this step takes too long, check if your uncommitted changes are too large.
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
+index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..092c080a008bcec38e566f776b324cb44e80450d 100644
+GIT binary patch
+delta 527
+zcmbV|y-EW?6h@iFQ~{G92(d9*1ww{<=YO`*H1>G`akIO@D2fmju}UFWSZ+ez!xgr$
+zmVj9JR||Q9yn>TWKrFRAT+Tgwle^;UdvS0>9=yp@cJ}D?$g1+C@g<{H2}GMrht;}5
+z6AGcbQNX}p5Q=UPfMV7%p>@<@*bS}HJj~wiy>0KuU^z1?ZN2Ok%BlvCi-B5(9I~xF
+z5|9#VAEXbOqESkSlzbeK`7QG$_?%OVDC`*f-bOv_0EEb+Kxt{Z7CVL^Moh;_3mqEa
+zdSei%(#rFu_sb!<)k%BYNN0MzP*F8>CC-jiYhwhY?c06g@bamo&LtVoTb5Y(C@C{2
+z5%NL)(~>*pgJ9Mkd96Ze5#lhX$gRn0d*pyr7afjj_YgQ2!;3y0tc<RcDW8#@WV+TU
+jANS6~!}zp$(z}YI=A~=;f_W*QkBLaR1TNTLOFzjsX}OJZ
+
+delta 13
+Ucmca`iTijrcS8%~7N+Az0WGx#QUCw|
+
+diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+index 9a48946..db58e91 100644
+--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
++++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+@@ -1019,3 +1019,45 @@ Traceback (most recent call last):
+   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
+     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
+ AttributeError: 'tuple' object has no attribute 'float'
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
++    trainer.train(n_train_steps=Config.n_steps_per_epoch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
++    loss, infos = self.model.loss(*batch)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
++    return self.dispatch_line(frame)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
++    if self.quitting: raise BdbQuit
++bdb.BdbQuit
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
++Traceback (most recent call last):
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
++    results = fn(*(args or ARGS), **_KWARGS)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
++    dataset = dataset_config()
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
++    instance = self._class(*args, **kwargs, **self._dict)
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
++    for i, episode in enumerate(itr):
++  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
++    target_task = list(env.tasks_to_complete)
++  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
++    return getattr(self._wrapped_env, attr)
++AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+diff --git a/analysis/outputs.log b/analysis/outputs.log
+index b36abbc..6f9fa2b 100644
+--- a/analysis/outputs.log
++++ b/analysis/outputs.log
+@@ -65,3 +65,7 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
++diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diff --git a/config/locomotion_config.py b/config/locomotion_config.py
+index 7c6d244..314d783 100644
+--- a/config/locomotion_config.py
++++ b/config/locomotion_config.py
+@@ -6,7 +6,7 @@ class Config(ParamsProto):
+     # misc
+     seed = 100
+     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
+-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
++    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
+ 
+     ## model
+diff --git a/diffuser/datasets/sequence.py b/diffuser/datasets/sequence.py
+index 7aa43ce..315a7fd 100644
+--- a/diffuser/datasets/sequence.py
++++ b/diffuser/datasets/sequence.py
+@@ -15,7 +15,7 @@ ValueBatch = namedtuple('ValueBatch', 'trajectories conditions values')
+         
+ class SequenceDataset(torch.utils.data.Dataset):
+ 
+-    def __init__(self, env='hopper-medium-replay', horizon=64,
++    def __init__(self, env='kitchen-mixed-v0', horizon=64,
+         normalizer='LimitsNormalizer', preprocess_fns=[], max_path_length=1000,
+         max_n_episodes=10000, termination_penalty=0, use_padding=True, discount=0.99, returns_scale=1000, include_returns=False):
+         self.preprocess_fn = get_preprocess_fn(preprocess_fns, env)
+diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
+index 43dfdbf..adc2a19 100644
+--- a/diffuser/models/diffusion.py
++++ b/diffuser/models/diffusion.py
+@@ -3,6 +3,7 @@ import torch
+ from torch import nn
+ import torch.nn.functional as F
+ import pdb
++import clip
+ from config.locomotion_config import Config
+ 
+ import diffuser.utils as utils
+@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
+         self.model = model
+         self.ar_inv = ar_inv
+         self.train_only_inv = train_only_inv
++        self.device = Config.device
+ 
+         # Text embedding
+-        device = Config.device
+-        self.proj_layer = nn.Linear(512, self.observation_dim)
++        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
++        self.text_encoder.float()
+ 
+         if self.ar_inv:
+             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
+diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
+index 0b6e0bf..a4200ea 100644
+--- a/diffuser/utils/training.py
++++ b/diffuser/utils/training.py
+@@ -113,7 +113,7 @@ class Trainer(object):
+             for i in range(self.gradient_accumulate_every):
+                 batch = next(self.dataloader)
+                 batch = batch_to_device(batch, device=self.device)
+-                # breakpoint()
++                breakpoint()
+                 loss, infos = self.model.loss(*batch)
+                 loss = loss / self.gradient_accumulate_every
+                 loss.backward()
\ No newline at end of file
diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/metrics.pkl
index 031fb19cf50d1ad3c96f3a0c847fc05a8c6104cb..3ede48a0e512b82aebeb11a518f77b6f7ca03fc5 100644
GIT binary patch
delta 11
ScmZ21zFmC7V(!ULSw#RH3j}xo

delta 7
OcmdlkzF2(2Vr~EoegfwJ

diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
index 0136a00..8a56a31 100644
--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
+++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/outputs.log
@@ -10016,3 +10016,577 @@ Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/
 │        loss        │       0.020        │
 ╘════════════════════╧════════════════════╛
 
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+    script_path     │ None                
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      counter       │ 2                   
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+       status       │ created             
+     createTime     │ 2023-12-05 16:58:52.964119
+════════════════════╧═════════════════════
+[33m      revision      [0m
+────────────────────┬─────────────────────
+        hash        │ 618c447fda2081ac4faa062992477db21fc9673c
+       branch       │ refs/heads/main     
+════════════════════╧═════════════════════
+[33m         fn         [0m
+────────────────────┬─────────────────────
+        name        │ main                
+        doc         │ None                
+       module       │ scripts.train       
+        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+════════════════════╧═════════════════════
+[33m        args        [0m
+────────────────────┬─────────────────────
+()
+════════════════════╧═════════════════════
+[33m       kwargs       [0m
+────────────────────┬─────────────────────
+     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        seed        │ 100                 
+ returns_condition  │ True                
+  predict_epsilon   │ True                
+ n_diffusion_steps  │ 200                 
+ condition_dropout  │ 0.25                
+     diffusion      │ models.GaussianInvDynDiffusion
+   n_train_steps    │ 1000000.0           
+      dataset       │ hopper-medium-expert-v2
+   returns_scale    │ 400.0               
+  RUN.job_counter   │ 1                   
+    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+════════════════════╧═════════════════════
+taking diff, if this step takes too long, check if your uncommitted changes are too large.
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       job_id       │ None                
+       status       │ started             
+     startTime      │ 2023-12-05 16:58:52.993286
+════════════════════╧═════════════════════
+[33m        host        [0m
+────────────────────┬─────────────────────
+      hostname      │ vll-weiyuan         
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m       Config       [0m
+────────────────────┬─────────────────────
+        seed        │ 100                 
+       device       │ cuda                
+       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+      dataset       │ hopper-medium-expert-v2
+       model        │ models.TemporalUnet 
+     diffusion      │ models.GaussianInvDynDiffusion
+      horizon       │ 100                 
+ n_diffusion_steps  │ 200                 
+   action_weight    │ 10                  
+    loss_weights    │ None                
+   loss_discount    │ 1                   
+  predict_epsilon   │ True                
+     dim_mults      │ (1, 4, 8)           
+ returns_condition  │ True                
+    calc_energy     │ False               
+        dim         │ 128                 
+ condition_dropout  │ 0.25                
+condition_guidance_w│ 1.2                 
+      test_ret      │ 0.9                 
+      renderer      │ utils.MuJoCoRenderer
+       loader       │ datasets.SequenceDataset
+     normalizer     │ CDFNormalizer       
+   preprocess_fns   │ []                  
+   clip_denoised    │ True                
+    use_padding     │ True                
+  include_returns   │ True                
+      discount      │ 0.99                
+  max_path_length   │ 1000                
+     hidden_dim     │ 256                 
+       ar_inv       │ False               
+   train_only_inv   │ False               
+termination_penalty │ -100                
+   returns_scale    │ 400.0               
+ n_steps_per_epoch  │ 10000               
+     loss_type      │ l2                  
+   n_train_steps    │ 1000000.0           
+     batch_size     │ 32                  
+   learning_rate    │ 0.0002              
+gradient_accumulate_every│ 2                   
+     ema_decay      │ 0.995               
+      log_freq      │ 1000                
+     save_freq      │ 10000               
+    sample_freq     │ 10000               
+      n_saves       │ 5                   
+   save_parallel    │ False               
+    n_reference     │ 8                   
+  save_checkpoints  │ False               
+════════════════════╧═════════════════════
+[33m        RUN         [0m
+────────────────────┬─────────────────────
+       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      username      │ yanyangji           
+      project       │ diffuser            
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+    script_path     │ None                
+        now         │ 2023-12-06 00:58:50.921304+08:00
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+    job_counter     │ 1                   
+       resume       │ True                
+       readme       │ None                
+       debug        │ False               
+CUDA_VISIBLE_DEVICES│ None                
+     file_stem      │ train               
+════════════════════╧═════════════════════
+Testing forward... ✓
+Epoch 0 / 100 | diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+    loss, infos = self.model.loss(*batch)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+    loss, infos = self.model.loss(*batch)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+    return self.dispatch_line(frame)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+    if self.quitting: raise BdbQuit
+bdb.BdbQuit
+
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       status       │ errored             
+     errorTime      │ 2023-12-05 17:05:07.186644
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+    script_path     │ None                
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      counter       │ 2                   
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+       status       │ created             
+     createTime     │ 2023-12-06 02:50:33.911493
+════════════════════╧═════════════════════
+[33m      revision      [0m
+────────────────────┬─────────────────────
+        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+       branch       │ refs/heads/main     
+════════════════════╧═════════════════════
+[33m         fn         [0m
+────────────────────┬─────────────────────
+        name        │ main                
+        doc         │ None                
+       module       │ scripts.train       
+        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+════════════════════╧═════════════════════
+[33m        args        [0m
+────────────────────┬─────────────────────
+()
+════════════════════╧═════════════════════
+[33m       kwargs       [0m
+────────────────────┬─────────────────────
+     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        seed        │ 100                 
+ returns_condition  │ True                
+  predict_epsilon   │ True                
+ n_diffusion_steps  │ 200                 
+ condition_dropout  │ 0.25                
+     diffusion      │ models.GaussianInvDynDiffusion
+   n_train_steps    │ 1000000.0           
+      dataset       │ hopper-medium-expert-v2
+   returns_scale    │ 400.0               
+  RUN.job_counter   │ 1                   
+    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+════════════════════╧═════════════════════
+taking diff, if this step takes too long, check if your uncommitted changes are too large.
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       job_id       │ None                
+       status       │ started             
+     startTime      │ 2023-12-06 02:50:33.953978
+════════════════════╧═════════════════════
+[33m        host        [0m
+────────────────────┬─────────────────────
+      hostname      │ vll-weiyuan         
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m       Config       [0m
+────────────────────┬─────────────────────
+        seed        │ 100                 
+       device       │ cuda                
+       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+      dataset       │ hopper-medium-expert-v2
+       model        │ models.TemporalUnet 
+     diffusion      │ models.GaussianInvDynDiffusion
+      horizon       │ 100                 
+ n_diffusion_steps  │ 200                 
+   action_weight    │ 10                  
+    loss_weights    │ None                
+   loss_discount    │ 1                   
+  predict_epsilon   │ True                
+     dim_mults      │ (1, 4, 8)           
+ returns_condition  │ True                
+    calc_energy     │ False               
+        dim         │ 128                 
+ condition_dropout  │ 0.25                
+condition_guidance_w│ 1.2                 
+      test_ret      │ 0.9                 
+      renderer      │ utils.MuJoCoRenderer
+       loader       │ datasets.SequenceDataset
+     normalizer     │ CDFNormalizer       
+   preprocess_fns   │ []                  
+   clip_denoised    │ True                
+    use_padding     │ True                
+  include_returns   │ True                
+      discount      │ 0.99                
+  max_path_length   │ 1000                
+     hidden_dim     │ 256                 
+       ar_inv       │ False               
+   train_only_inv   │ False               
+termination_penalty │ -100                
+   returns_scale    │ 400.0               
+ n_steps_per_epoch  │ 10000               
+     loss_type      │ l2                  
+   n_train_steps    │ 1000000.0           
+     batch_size     │ 32                  
+   learning_rate    │ 0.0002              
+gradient_accumulate_every│ 2                   
+     ema_decay      │ 0.995               
+      log_freq      │ 1000                
+     save_freq      │ 10000               
+    sample_freq     │ 10000               
+      n_saves       │ 5                   
+   save_parallel    │ False               
+    n_reference     │ 8                   
+  save_checkpoints  │ False               
+════════════════════╧═════════════════════
+[33m        RUN         [0m
+────────────────────┬─────────────────────
+       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      username      │ yanyangji           
+      project       │ diffuser            
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+    script_path     │ None                
+        now         │ 2023-12-06 10:50:31.778840+08:00
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+    job_counter     │ 1                   
+       resume       │ True                
+       readme       │ None                
+       debug        │ False               
+CUDA_VISIBLE_DEVICES│ None                
+     file_stem      │ train               
+════════════════════╧═════════════════════
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       status       │ errored             
+     errorTime      │ 2023-12-06 02:50:35.849523
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+    script_path     │ None                
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      counter       │ 2                   
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        name        │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+       status       │ created             
+     createTime     │ 2023-12-06 02:54:15.281510
+════════════════════╧═════════════════════
+[33m      revision      [0m
+────────────────────┬─────────────────────
+        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+       branch       │ refs/heads/main     
+════════════════════╧═════════════════════
+[33m         fn         [0m
+────────────────────┬─────────────────────
+        name        │ main                
+        doc         │ None                
+       module       │ scripts.train       
+        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+════════════════════╧═════════════════════
+[33m        args        [0m
+────────────────────┬─────────────────────
+()
+════════════════════╧═════════════════════
+[33m       kwargs       [0m
+────────────────────┬─────────────────────
+     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        seed        │ 100                 
+ returns_condition  │ True                
+  predict_epsilon   │ True                
+ n_diffusion_steps  │ 200                 
+ condition_dropout  │ 0.25                
+     diffusion      │ models.GaussianInvDynDiffusion
+   n_train_steps    │ 1000000.0           
+      dataset       │ hopper-medium-expert-v2
+   returns_scale    │ 400.0               
+  RUN.job_counter   │ 1                   
+    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+════════════════════╧═════════════════════
+taking diff, if this step takes too long, check if your uncommitted changes are too large.
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       job_id       │ None                
+       status       │ started             
+     startTime      │ 2023-12-06 02:54:15.328619
+════════════════════╧═════════════════════
+[33m        host        [0m
+────────────────────┬─────────────────────
+      hostname      │ vll-weiyuan         
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m       Config       [0m
+────────────────────┬─────────────────────
+        seed        │ 100                 
+       device       │ cuda                
+       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+      dataset       │ hopper-medium-expert-v2
+       model        │ models.TemporalUnet 
+     diffusion      │ models.GaussianInvDynDiffusion
+      horizon       │ 100                 
+ n_diffusion_steps  │ 200                 
+   action_weight    │ 10                  
+    loss_weights    │ None                
+   loss_discount    │ 1                   
+  predict_epsilon   │ True                
+     dim_mults      │ (1, 4, 8)           
+ returns_condition  │ True                
+    calc_energy     │ False               
+        dim         │ 128                 
+ condition_dropout  │ 0.25                
+condition_guidance_w│ 1.2                 
+      test_ret      │ 0.9                 
+      renderer      │ utils.MuJoCoRenderer
+       loader       │ datasets.SequenceDataset
+     normalizer     │ CDFNormalizer       
+   preprocess_fns   │ []                  
+   clip_denoised    │ True                
+    use_padding     │ True                
+  include_returns   │ True                
+      discount      │ 0.99                
+  max_path_length   │ 1000                
+     hidden_dim     │ 256                 
+       ar_inv       │ False               
+   train_only_inv   │ False               
+termination_penalty │ -100                
+   returns_scale    │ 400.0               
+ n_steps_per_epoch  │ 10000               
+     loss_type      │ l2                  
+   n_train_steps    │ 1000000.0           
+     batch_size     │ 32                  
+   learning_rate    │ 0.0002              
+gradient_accumulate_every│ 2                   
+     ema_decay      │ 0.995               
+      log_freq      │ 1000                
+     save_freq      │ 10000               
+    sample_freq     │ 10000               
+      n_saves       │ 5                   
+   save_parallel    │ False               
+    n_reference     │ 8                   
+  save_checkpoints  │ False               
+════════════════════╧═════════════════════
+[33m        RUN         [0m
+────────────────────┬─────────────────────
+       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      username      │ yanyangji           
+      project       │ diffuser            
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+    script_path     │ None                
+        now         │ 2023-12-06 10:54:13.139864+08:00
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+    job_counter     │ 1                   
+       resume       │ True                
+       readme       │ None                
+       debug        │ False               
+CUDA_VISIBLE_DEVICES│ None                
+     file_stem      │ train               
+════════════════════╧═════════════════════
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       status       │ errored             
+     errorTime      │ 2023-12-06 02:54:17.280334
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+    script_path     │ None                
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      counter       │ 2                   
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        name        │ predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
+       status       │ created             
+     createTime     │ 2023-12-06 03:05:11.350342
+════════════════════╧═════════════════════
+[33m      revision      [0m
+────────────────────┬─────────────────────
+        hash        │ cb00c13da6758f91b8211d27e6747c84964e0416
+       branch       │ refs/heads/main     
+════════════════════╧═════════════════════
+[33m         fn         [0m
+────────────────────┬─────────────────────
+        name        │ main                
+        doc         │ None                
+       module       │ scripts.train       
+        file        │ /home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py
+════════════════════╧═════════════════════
+[33m        args        [0m
+────────────────────┬─────────────────────
+()
+════════════════════╧═════════════════════
+[33m       kwargs       [0m
+────────────────────┬─────────────────────
+     RUN.prefix     │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+        seed        │ 100                 
+ returns_condition  │ True                
+  predict_epsilon   │ True                
+ n_diffusion_steps  │ 200                 
+ condition_dropout  │ 0.25                
+     diffusion      │ models.GaussianInvDynDiffusion
+   n_train_steps    │ 1000000.0           
+      dataset       │ hopper-medium-expert-v2
+   returns_scale    │ 400.0               
+  RUN.job_counter   │ 1                   
+    RUN.job_name    │ predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
+════════════════════╧═════════════════════
+taking diff, if this step takes too long, check if your uncommitted changes are too large.
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       job_id       │ None                
+       status       │ started             
+     startTime      │ 2023-12-06 03:05:11.392066
+════════════════════╧═════════════════════
+[33m        host        [0m
+────────────────────┬─────────────────────
+      hostname      │ vll-weiyuan         
+════════════════════╧═════════════════════
+══════════════════════════════════════════
+[33m       Config       [0m
+────────────────────┬─────────────────────
+        seed        │ 100                 
+       device       │ cuda                
+       bucket       │ /home/yanyangji/research/RL/final/decision-diffuser/code/output
+      dataset       │ hopper-medium-expert-v2
+       model        │ models.TemporalUnet 
+     diffusion      │ models.GaussianInvDynDiffusion
+      horizon       │ 100                 
+ n_diffusion_steps  │ 200                 
+   action_weight    │ 10                  
+    loss_weights    │ None                
+   loss_discount    │ 1                   
+  predict_epsilon   │ True                
+     dim_mults      │ (1, 4, 8)           
+ returns_condition  │ True                
+    calc_energy     │ False               
+        dim         │ 128                 
+ condition_dropout  │ 0.25                
+condition_guidance_w│ 1.2                 
+      test_ret      │ 0.9                 
+      renderer      │ utils.MuJoCoRenderer
+       loader       │ datasets.SequenceDataset
+     normalizer     │ CDFNormalizer       
+   preprocess_fns   │ []                  
+   clip_denoised    │ True                
+    use_padding     │ True                
+  include_returns   │ True                
+      discount      │ 0.99                
+  max_path_length   │ 1000                
+     hidden_dim     │ 256                 
+       ar_inv       │ False               
+   train_only_inv   │ False               
+termination_penalty │ -100                
+   returns_scale    │ 400.0               
+ n_steps_per_epoch  │ 10000               
+     loss_type      │ l2                  
+   n_train_steps    │ 1000000.0           
+     batch_size     │ 32                  
+   learning_rate    │ 0.0002              
+gradient_accumulate_every│ 2                   
+     ema_decay      │ 0.995               
+      log_freq      │ 1000                
+     save_freq      │ 10000               
+    sample_freq     │ 10000               
+      n_saves       │ 5                   
+   save_parallel    │ False               
+    n_reference     │ 8                   
+  save_checkpoints  │ False               
+════════════════════╧═════════════════════
+[33m        RUN         [0m
+────────────────────┬─────────────────────
+       server       │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+      username      │ yanyangji           
+      project       │ diffuser            
+    script_root     │ /home/yanyangji/research/RL/final/decision-diffuser/code/analysis
+    script_path     │ None                
+        now         │ 2023-12-06 11:05:09.240831+08:00
+       prefix       │ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+      job_name      │ predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
+    job_counter     │ 1                   
+       resume       │ True                
+       readme       │ None                
+       debug        │ False               
+CUDA_VISIBLE_DEVICES│ None                
+     file_stem      │ train               
+════════════════════╧═════════════════════
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+
+══════════════════════════════════════════
+[33m        job         [0m
+────────────────────┬─────────────────────
+       status       │ errored             
+     errorTime      │ 2023-12-06 03:05:13.360753
+════════════════════╧═════════════════════
diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/parameters.pkl
index cbcf883cdb5a05ecbe7623de4e9a9a6c5ec6aab9..dcb3bf933270214a935cf84c18a923c6cac403f1 100644
GIT binary patch
delta 631
zcmbV}F-sgl6vvsxs|5833fkmiB@u`B=FPmB*(P3d{e1z+-tHY<L=iMWOk+eyk#dzQ
zQl+wYg)LGCL2Sf6<jPb+K0#(zQ7kNy_Rr(@e((P-zD)l9HF<C(&ZCPT<@WbzD5f|z
zE;dSf)`&hIAI~o_x>RdB$Pxt(lT;6q1Xy{mw6$4J;UM*FDJ`$hqQ&Tu;7K_y+E=TM
z8Eyg8V31xRLHVj95;2W71`~so=$N%G#LYWV&8pZyOe8&`_9NVh7M9W;K#G(lY>gXu
z>^X&)DcfhOZR&LJ?Sn=xnwKx5Ck#X0=H1b9ack!qO>SW@33Qa!I;WxNeqIwHzF%r&
zU>QZV%YCe4G*US<2z4R<<5DxKLa^+fMD51(ok)mDB6(M~I^wOEzw-#G4GV!tAHUy`
z2NNgz`Iv6Sn|%CYd1hm{o38h_RyK!w{cPn!aQX?ADOF`6N-{uN{k!QChF8Fxx369c
p&hhZHSe087p;pBDV_qr^jz*upijU7(wf}sZeXt@)4AxL}&R@yxs=NRI

delta 13
UcmaF)fctnicS8%~7N+Az0WYEkc>n+a

diff --git a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
index 9a48946..f8c6a65 100644
--- a/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
+++ b/analysis/diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100/traceback.err
@@ -1019,3 +1019,59 @@ Traceback (most recent call last):
   File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/models/temporal.py", line 158, in __init__
     clip_model, _ = clip.load("ViT-B/32", device=Config.device).float()
 AttributeError: 'tuple' object has no attribute 'float'
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 176, in main
+    trainer.train(n_train_steps=Config.n_steps_per_epoch)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+    loss, infos = self.model.loss(*batch)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/training.py", line 117, in train
+    loss, infos = self.model.loss(*batch)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 88, in trace_dispatch
+    return self.dispatch_line(frame)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/bdb.py", line 113, in dispatch_line
+    if self.quitting: raise BdbQuit
+bdb.BdbQuit
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
+Traceback (most recent call last):
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/ml_logger/__init__.py", line 203, in thunk
+    results = fn(*(args or ARGS), **_KWARGS)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/scripts/train.py", line 49, in main
+    dataset = dataset_config()
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/utils/config.py", line 65, in __call__
+    instance = self._class(*args, **kwargs, **self._dict)
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/sequence.py", line 33, in __init__
+    for i, episode in enumerate(itr):
+  File "/home/yanyangji/research/RL/final/decision-diffuser/code/diffuser/datasets/d4rl.py", line 113, in sequence_dataset
+    target_task = list(env.tasks_to_complete)
+  File "/home/yanyangji/anaconda3/envs/decdiff/lib/python3.8/site-packages/d4rl/utils/wrappers.py", line 43, in __getattr__
+    return getattr(self._wrapped_env, attr)
+AttributeError: 'OfflineHopperEnv' object has no attribute 'tasks_to_complete'
diff --git a/analysis/outputs.log b/analysis/outputs.log
index b36abbc..997bb53 100644
--- a/analysis/outputs.log
+++ b/analysis/outputs.log
@@ -65,3 +65,9 @@ diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-ex
 diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
 diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
 diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/hopper-medium-expert-v2/100
+diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
+diffuser/default_inv/predict_epsilon_200_1000000.0/dropout_0.25/kitchen-mixed-v0/100
diff --git a/config/locomotion_config.py b/config/locomotion_config.py
index 7c6d244..314d783 100644
--- a/config/locomotion_config.py
+++ b/config/locomotion_config.py
@@ -6,7 +6,7 @@ class Config(ParamsProto):
     # misc
     seed = 100
     device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
-    bucket = '/home/sonicbenz/Benz/course/RL/decision-diffuser/code/analysis/weights/'#'/home/yanyangji/research/RL/final/decision-diffuser/code/output'
+    bucket = '/home/yanyangji/research/RL/final/decision-diffuser/code/output'
     dataset = 'kitchen-mixed-v0' #'hopper-medium-expert-v2'
 
     ## model
diff --git a/diffuser/datasets/sequence.py b/diffuser/datasets/sequence.py
index 7aa43ce..315a7fd 100644
--- a/diffuser/datasets/sequence.py
+++ b/diffuser/datasets/sequence.py
@@ -15,7 +15,7 @@ ValueBatch = namedtuple('ValueBatch', 'trajectories conditions values')
         
 class SequenceDataset(torch.utils.data.Dataset):
 
-    def __init__(self, env='hopper-medium-replay', horizon=64,
+    def __init__(self, env='kitchen-mixed-v0', horizon=64,
         normalizer='LimitsNormalizer', preprocess_fns=[], max_path_length=1000,
         max_n_episodes=10000, termination_penalty=0, use_padding=True, discount=0.99, returns_scale=1000, include_returns=False):
         self.preprocess_fn = get_preprocess_fn(preprocess_fns, env)
diff --git a/diffuser/models/diffusion.py b/diffuser/models/diffusion.py
index 43dfdbf..adc2a19 100644
--- a/diffuser/models/diffusion.py
+++ b/diffuser/models/diffusion.py
@@ -3,6 +3,7 @@ import torch
 from torch import nn
 import torch.nn.functional as F
 import pdb
+import clip
 from config.locomotion_config import Config
 
 import diffuser.utils as utils
@@ -302,10 +303,11 @@ class GaussianInvDynDiffusion(nn.Module):
         self.model = model
         self.ar_inv = ar_inv
         self.train_only_inv = train_only_inv
+        self.device = Config.device
 
         # Text embedding
-        device = Config.device
-        self.proj_layer = nn.Linear(512, self.observation_dim)
+        self.text_encoder, _ = clip.load("ViT-B/32", device=self.device)
+        self.text_encoder.float()
 
         if self.ar_inv:
             self.inv_model = ARInvModel(hidden_dim=hidden_dim, observation_dim=observation_dim, action_dim=action_dim)
diff --git a/diffuser/utils/training.py b/diffuser/utils/training.py
index 0b6e0bf..a4200ea 100644
--- a/diffuser/utils/training.py
+++ b/diffuser/utils/training.py
@@ -113,7 +113,7 @@ class Trainer(object):
             for i in range(self.gradient_accumulate_every):
                 batch = next(self.dataloader)
                 batch = batch_to_device(batch, device=self.device)
-                # breakpoint()
+                breakpoint()
                 loss, infos = self.model.loss(*batch)
                 loss = loss / self.gradient_accumulate_every
                 loss.backward()